<!DOCTYPE html>
 <html lang="en">

 <head>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>rushikesh </title>

     <link rel="preconnect" href="https://fonts.googleapis.com">
     <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
     <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
     
     <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js"></script>

     <style>
         /* CSS Reset and Global Styles */
         :root {
             --primary-color: #FF9900; /* Amazon Orange for key actions */
             --secondary-color: #BBBBBB; /* Lighter gray for secondary text in dark mode */
             --success-color: #28a745;
             --danger-color: #dc3545;
             --light-color: #333333; /* Darker background for light elements in dark mode */
             --dark-color: #131921; /* Amazon Dark Blue/Black for header/primary background */
             --background-color: var(--dark-color); /* Main background is dark (Request 2) */
             --text-color: #f8f9fa; /* Near white text for dark mode */
             --font-family: 'Poppins', sans-serif;
             --box-shadow: 0 4px 6px rgba(255, 255, 255, 0.1); /* Adjusted shadow for dark mode */
             --border-radius: 8px;
         }

         * {
             margin: 0;
             padding: 0;
             box-sizing: border-box;
         }

         body {
             font-family: var(--font-family);
             background-color: var(--background-color); /* Dark Background */
             color: var(--text-color); /* Light Text */
             padding-top: 60px;
             /* Space for fixed header */
             padding-bottom: 60px;
             /* Space for fixed footer */
         }
         
         /* Adjust card/container backgrounds for contrast on dark body */
         .product-card, #profile .profile-card, #product-detail-page .page-header {
            background-color: #20262c; /* Slightly lighter dark color for elements */
            border-color: #444;
         }
         
         .categories, #search-input, #contact-form input, #contact-form textarea {
             background-color: #20262c;
             color: var(--text-color);
             border-color: #444;
         }
         
         input[type="text"], input[type="email"], input[type="password"], input[type="tel"], textarea {
             border: 1px solid #444;
         }
         
         /* --- ANIMATION (Request 1) --- */
         @keyframes pulse-animation {
             0% { transform: scale(1); opacity: 1; }
             50% { transform: scale(1.05); opacity: 0.8; }
             100% { transform: scale(1); opacity: 1; }
         }
         
         .header .logo.animated {
             animation: pulse-animation 2s infinite ease-in-out;
         }

         /* --- NEW: SCROLL ANIMATION CSS --- */
         @keyframes fadeIn {
             from {
                 opacity: 0;
                 transform: translateY(20px);
             }
             to {
                 opacity: 1;
                 transform: translateY(0);
             }
         }

         .product-card.hidden {
             opacity: 0;
             transition: opacity 0.5s ease-out, transform 0.5s ease-out;
         }

         .product-card.animate-scroll {
             animation: fadeIn 0.5s ease-out forwards;
         }
         /* --- END NEW SCROLL ANIMATION CSS --- */


         /* --- UTILITY CLASSES --- */
         .page {
             display: none;
             /* Ensure standard pages take up full height for the product detail view */
             min-height: calc(100vh - 60px); 
         }

         .page.active {
             display: block;
         }

         .modal {
             display: none;
             position: fixed;
             z-index: 1000;
             left: 0;
             top: 0;
             width: 100%;
             height: 100%;
             overflow: auto;
             background-color: rgba(0, 0, 0, 0.7); /* Darker backdrop */
             align-items: center;
             justify-content: center;
         }

         .modal.active {
             display: flex;
         }

         .modal-content {
             background-color: #fff; /* Modal content remains white for contrast */
             color: #111; /* Dark text on white modal background */
             padding: 20px;
             border-radius: var(--border-radius);
             box-shadow: var(--box-shadow);
             width: 90%;
             max-width: 500px;
             position: relative;
         }

         .modal-content h2, .modal-content h4, .modal-content p, .modal-content strong, .modal-content span {
            color: #111; /* Ensure dark text inside white modals */
         }


         .close-btn {
             position: absolute;
             top: 10px;
             right: 15px;
             font-size: 24px;
             font-weight: bold;
             cursor: pointer;
             color: var(--secondary-color);
         }

         button,
         .btn {
             padding: 10px 15px;
             border: none;
             background-color: var(--primary-color);
             color: var(--dark-color); /* Changed button text color to dark for contrast with orange */
             border-radius: 5px;
             cursor: pointer;
             font-family: var(--font-family);
             font-size: 1rem;
             transition: background-color 0.3s;
         }

         button:hover,
         .btn:hover {
             background-color: #e68a00; /* Darker orange on hover */
         }

         .btn-danger {
             background-color: var(--danger-color);
             color: white; /* Ensure danger button text is white */
         }

         .btn-danger:hover {
             background-color: #c82333;
         }

         input[type="text"],
         input[type="email"],
         input[type="password"],
         input[type="tel"], /* Added for phone number */
         textarea {
             width: 100%;
             padding: 10px;
             margin: 8px 0;
             display: inline-block;
             /* Adjusted for dark mode contrast */
             border: 1px solid #ccc;
             background-color: #fff;
             color: #111;
             border-radius: 4px;
             box-sizing: border-box;
             font-family: var(--font-family);
         }
         
         #search-input {
             border: 1px solid #444;
             background-color: #20262c;
             color: var(--text-color);
         }

         /* --- HEADER --- */
         .header {
             position: fixed;
             top: 0;
             left: 0;
             width: 100%;
             height: 60px;
             background-color: var(--dark-color); /* Changed to dark Amazon color */
             display: flex;
             justify-content: space-between;
             align-items: center;
             padding: 0 20px;
             box-shadow: var(--box-shadow);
             z-index: 999;
         }

         .header .logo {
             font-size: 1.5rem;
             font-weight: 600;
             color: white; /* Changed from var(--primary-color) to white for dark background */
         }

         .header .header-icons {
             display: flex;
             align-items: center;
             gap: 15px;
         }
         
         .header .search-icon, .header .cart-icon i {
             font-size: 1.2rem;
             cursor: pointer;
             color: white; /* Changed from var(--dark-color) to white for dark background */
         }
         .header .cart-icon {
            position: relative;
            text-decoration: none;
         }
         
         /* --- BOTTOM NAVIGATION --- */
         .bottom-nav {
             position: fixed;
             bottom: 0;
             left: 0;
             width: 100%;
             height: 60px;
             background-color: #20262c; /* Darker bottom nav */
             display: flex;
             justify-content: space-around;
             align-items: center;
             box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.5);
             z-index: 999;
         }

         .nav-item {
             display: flex;
             flex-direction: column;
             align-items: center;
             color: var(--secondary-color);
             text-decoration: none;
             position: relative;
         }

         .nav-item.active {
             color: var(--primary-color);
         }

         .nav-item i {
             font-size: 1.5rem;
         }

         .nav-item span {
             font-size: 0.7rem;
         }

         .badge {
             position: absolute;
             top: -5px;
             right: -10px;
             background-color: var(--danger-color);
             color: white;
             border-radius: 50%;
             padding: 2px 6px;
             font-size: 0.7rem;
             display: none;
             /* Hidden by default */
         }

         .badge.active {
             display: block;
         }

         /* --- HOME PAGE --- */
         #home .slider-container {
             width: 100%;
             height: 200px;
             position: relative;
             overflow: hidden;
             background: linear-gradient(45deg, #FF9900, #ffc866); /* Updated gradient to orange shades */
             margin-bottom: 20px;
         }

         .slider {
             display: flex;
             transition: transform 0.5s ease-in-out;
         }

         .slide {
             min-width: 100%;
             height: 200px;
         }

         .slide img {
             width: 100%;
             height: 100%;
             object-fit: cover;
         }

         .fallback-slide {
             display: flex;
             justify-content: center;
             align-items: center;
             color: white;
             font-size: 2rem;
             font-weight: 600;
         }

         .slider-nav {
             position: absolute;
             top: 50%;
             transform: translateY(-50%);
             background: rgba(0, 0, 0, 0.5);
             color: white;
             border: none;
             padding: 10px;
             cursor: pointer;
             z-index: 10;
         }

         .prev-slide {
             left: 10px;
         }

         .next-slide {
             right: 10px;
         }

         .categories {
             display: flex;
             overflow-x: auto;
             padding: 10px;
             gap: 10px;
             -ms-overflow-style: none;
             /* IE and Edge */
             scrollbar-width: none;
             /* Firefox */
         }

         .categories::-webkit-scrollbar {
             display: none;
         }

         /* Request 5: Category styling for non-button look */
         .category-bubble {
             padding: 8px 15px;
             border-radius: 20px;
             cursor: pointer;
             white-space: nowrap;
             color: var(--text-color); /* Light text */
             font-weight: 500;
             background-color: #333; /* Darker background */
             border: 1px solid #555; /* Lighter border */
             transition: all 0.2s;
         }

         .category-bubble.active {
             border: 2px solid var(--primary-color);
             background-color: #20262c; /* Slightly lighter dark background for active */
             transform: scale(1.02);
         }

         .product-grid {
             display: grid;
             grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
             gap: 15px;
             padding: 15px;
         }

         .product-card {
             border: 1px solid #333; /* Dark mode border */
             border-radius: var(--border-radius);
             overflow: hidden;
             text-align: center;
             box-shadow: var(--box-shadow);
             cursor: pointer; /* Makes the entire card appear clickable */
             display: flex;
             flex-direction: column;
             justify-content: space-between;
             background-color: #20262c; /* Dark mode background */
             position: relative; /* Badge positioning context */
         }

         /* --- NEW: OFFER BADGE STYLE --- */
         .offer-badge {
             position: absolute;
             top: 10px;
             right: 10px;
             background-color: var(--danger-color); /* Red color for offers */
             color: white;
             padding: 4px 8px;
             border-radius: 4px;
             font-size: 0.75rem;
             font-weight: 600;
             z-index: 10; /* Ensures it is above the image */
             box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
             transform: rotate(5deg); /* Slight rotation for attention */
         }
         /* --- END NEW: OFFER BADGE STYLE --- */

         .product-card img {
             width: 100%;
             height: 150px;
             object-fit: cover;
         }

         .product-info {
             padding: 10px;
         }

         .product-info h3 {
             font-size: 1rem;
             margin-bottom: 5px;
         }
          .product-info .price {
             color: var(--primary-color);
             font-weight: 600;
         }

         /* Removed .product-actions CSS as the div is removed from the product grid cards */

         /* Request 2: Add to cart button style (Kept for Modal/Page) */
         .add-to-cart-btn {
             background-color: var(--primary-color);
             color: var(--dark-color); /* Dark text for orange button */
             border: none;
             padding: 6px 10px; /* Reduced padding */
             border-radius: 5px;
             cursor: pointer;
             font-size: 0.8rem;
             width: 100%; /* Made full width */
         }

         .add-to-wishlist-btn {
             background: none;
             border: none;
             font-size: 1.2rem;
             cursor: pointer;
             color: var(--secondary-color);
         }

         .add-to-wishlist-btn.active {
             color: var(--danger-color);
         }

         /* --- PRODUCT DETAIL PAGE STYLES (NEW) --- */
         #product-detail-page {
            /* Full page view, no fixed header/footer padding in content area */
            padding-bottom: 60px; /* Space for bottom nav */
         }
         #product-detail-page .page-header {
            position: sticky;
            top: 60px; /* Below the fixed main header */
            z-index: 500;
         }
         #product-detail-content {
             padding: 15px;
         }
         #product-detail-page .product-image-wrapper {
             max-width: 300px; /* Constrain image size */
             margin: 0 auto 15px;
         }
         #product-detail-page img {
             width: 100%;
             height: auto;
             border-radius: var(--border-radius);
             display: block;
         }

         #product-detail-page h2 {
             margin: 15px 0;
         }

         #product-detail-page .price {
             font-size: 1.5rem;
             color: var(--primary-color);
             font-weight: bold;
         }
         
         /* --- NEW STYLES FOR MARKDOWN GENERATED CONTENT (Used for Product Detail AND About Us) --- */
         #product-detail-content #product-description-container h3,
         #about-content-container h3 {
             margin-top: 20px;
             margin-bottom: 5px;
             font-size: 1.1rem;
             color: var(--text-color); 
             border-bottom: 1px solid #444;
             padding-bottom: 5px;
         }
<!DOCTYPE html>
 <html lang="en">

 <head>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>rushikesh </title>

     <link rel="preconnect" href="https://fonts.googleapis.com">
     <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
     <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
     
     <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js"></script>

     <style>
         /* CSS Reset and Global Styles */
         :root {
             --primary-color: #FF9900; /* Amazon Orange for key actions */
             --secondary-color: #BBBBBB; /* Lighter gray for secondary text in dark mode */
             --success-color: #28a745;
             --danger-color: #dc3545;
             --light-color: #333333; /* Darker background for light elements in dark mode */
             --dark-color: #131921; /* Amazon Dark Blue/Black for header/primary background */
             --background-color: var(--dark-color); /* Main background is dark (Request 2) */
             --text-color: #f8f9fa; /* Near white text for dark mode */
             --font-family: 'Poppins', sans-serif;
             --box-shadow: 0 4px 6px rgba(255, 255, 255, 0.1); /* Adjusted shadow for dark mode */
             --border-radius: 8px;
         }

         * {
             margin: 0;
             padding: 0;
             box-sizing: border-box;
         }

         body {
             font-family: var(--font-family);
             background-color: var(--background-color); /* Dark Background */
             color: var(--text-color); /* Light Text */
             padding-top: 60px;
             /* Space for fixed header */
             padding-bottom: 60px;
             /* Space for fixed footer */
         }
         
         /* Adjust card/container backgrounds for contrast on dark body */
         .product-card, #profile .profile-card, #product-detail-page .page-header {
            background-color: #20262c; /* Slightly lighter dark color for elements */
            border-color: #444;
         }
         
         .categories, #search-input, #contact-form input, #contact-form textarea {
             background-color: #20262c;
             color: var(--text-color);
             border-color: #444;
         }
         
         input[type="text"], input[type="email"], input[type="password"], input[type="tel"], textarea {
             border: 1px solid #444;
         }
         
         /* --- ANIMATION (Request 1) --- */
         @keyframes pulse-animation {
             0% { transform: scale(1); opacity: 1; }
             50% { transform: scale(1.05); opacity: 0.8; }
             100% { transform: scale(1); opacity: 1; }
         }
         
         .header .logo.animated {
             animation: pulse-animation 2s infinite ease-in-out;
         }

         /* --- NEW: SCROLL ANIMATION CSS --- */
         @keyframes fadeIn {
             from {
                 opacity: 0;
                 transform: translateY(20px);
             }
             to {
                 opacity: 1;
                 transform: translateY(0);
             }
         }

         .product-card.hidden {
             opacity: 0;
             transition: opacity 0.5s ease-out, transform 0.5s ease-out;
         }

         .product-card.animate-scroll {
             animation: fadeIn 0.5s ease-out forwards;
         }
         /* --- END NEW SCROLL ANIMATION CSS --- */


         /* --- UTILITY CLASSES --- */
         .page {
             display: none;
             /* Ensure standard pages take up full height for the product detail view */
             min-height: calc(100vh - 60px); 
         }

         .page.active {
             display: block;
         }

         .modal {
             display: none;
             position: fixed;
             z-index: 1000;
             left: 0;
             top: 0;
             width: 100%;
             height: 100%;
             overflow: auto;
             background-color: rgba(0, 0, 0, 0.7); /* Darker backdrop */
             align-items: center;
             justify-content: center;
         }

         .modal.active {
             display: flex;
         }

         .modal-content {
             background-color: #fff; /* Modal content remains white for contrast */
             color: #111; /* Dark text on white modal background */
             padding: 20px;
             border-radius: var(--border-radius);
             box-shadow: var(--box-shadow);
             width: 90%;
             max-width: 500px;
             position: relative;
         }

         .modal-content h2, .modal-content h4, .modal-content p, .modal-content strong, .modal-content span {
            color: #111; /* Ensure dark text inside white modals */
         }


         .close-btn {
             position: absolute;
             top: 10px;
             right: 15px;
             font-size: 24px;
             font-weight: bold;
             cursor: pointer;
             color: var(--secondary-color);
         }

         button,
         .btn {
             padding: 10px 15px;
             border: none;
             background-color: var(--primary-color);
             color: var(--dark-color); /* Changed button text color to dark for contrast with orange */
             border-radius: 5px;
             cursor: pointer;
             font-family: var(--font-family);
             font-size: 1rem;
             transition: background-color 0.3s;
         }

         button:hover,
         .btn:hover {
             background-color: #e68a00; /* Darker orange on hover */
         }

         .btn-danger {
             background-color: var(--danger-color);
             color: white; /* Ensure danger button text is white */
         }

         .btn-danger:hover {
             background-color: #c82333;
         }

         input[type="text"],
         input[type="email"],
         input[type="password"],
         input[type="tel"], /* Added for phone number */
         textarea {
             width: 100%;
             padding: 10px;
             margin: 8px 0;
             display: inline-block;
             /* Adjusted for dark mode contrast */
             border: 1px solid #ccc;
             background-color: #fff;
             color: #111;
             border-radius: 4px;
             box-sizing: border-box;
             font-family: var(--font-family);
         }
         
         #search-input {
             border: 1px solid #444;
             background-color: #20262c;
             color: var(--text-color);
         }

         /* --- HEADER --- */
         .header {
             position: fixed;
             top: 0;
             left: 0;
             width: 100%;
             height: 60px;
             background-color: var(--dark-color); /* Changed to dark Amazon color */
             display: flex;
             justify-content: space-between;
             align-items: center;
             padding: 0 20px;
             box-shadow: var(--box-shadow);
             z-index: 999;
         }

         .header .logo {
             font-size: 1.5rem;
             font-weight: 600;
             color: white; /* Changed from var(--primary-color) to white for dark background */
         }

         .header .header-icons {
             display: flex;
             align-items: center;
             gap: 15px;
         }
         
         .header .search-icon, .header .cart-icon i {
             font-size: 1.2rem;
             cursor: pointer;
             color: white; /* Changed from var(--dark-color) to white for dark background */
         }
         .header .cart-icon {
            position: relative;
            text-decoration: none;
         }
         
         /* --- BOTTOM NAVIGATION --- */
         .bottom-nav {
             position: fixed;
             bottom: 0;
             left: 0;
             width: 100%;
             height: 60px;
             background-color: #20262c; /* Darker bottom nav */
             display: flex;
             justify-content: space-around;
             align-items: center;
             box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.5);
             z-index: 999;
         }

         .nav-item {
             display: flex;
             flex-direction: column;
             align-items: center;
             color: var(--secondary-color);
             text-decoration: none;
             position: relative;
         }

         .nav-item.active {
             color: var(--primary-color);
         }

         .nav-item i {
             font-size: 1.5rem;
         }

         .nav-item span {
             font-size: 0.7rem;
         }

         .badge {
             position: absolute;
             top: -5px;
             right: -10px;
             background-color: var(--danger-color);
             color: white;
             border-radius: 50%;
             padding: 2px 6px;
             font-size: 0.7rem;
             display: none;
             /* Hidden by default */
         }

         .badge.active {
             display: block;
         }

         /* --- HOME PAGE --- */
         #home .slider-container {
             width: 100%;
             height: 200px;
             position: relative;
             overflow: hidden;
             background: linear-gradient(45deg, #FF9900, #ffc866); /* Updated gradient to orange shades */
             margin-bottom: 20px;
         }

         .slider {
             display: flex;
             transition: transform 0.5s ease-in-out;
         }

         .slide {
             min-width: 100%;
             height: 200px;
         }

         .slide img {
             width: 100%;
             height: 100%;
             object-fit: cover;
         }

         .fallback-slide {
             display: flex;
             justify-content: center;
             align-items: center;
             color: white;
             font-size: 2rem;
             font-weight: 600;
         }

         .slider-nav {
             position: absolute;
             top: 50%;
             transform: translateY(-50%);
             background: rgba(0, 0, 0, 0.5);
             color: white;
             border: none;
             padding: 10px;
             cursor: pointer;
             z-index: 10;
         }

         .prev-slide {
             left: 10px;
         }

         .next-slide {
             right: 10px;
         }

         .categories {
             display: flex;
             overflow-x: auto;
             padding: 10px;
             gap: 10px;
             -ms-overflow-style: none;
             /* IE and Edge */
             scrollbar-width: none;
             /* Firefox */
         }

         .categories::-webkit-scrollbar {
             display: none;
         }

         /* Request 5: Category styling for non-button look */
         .category-bubble {
             padding: 8px 15px;
             border-radius: 20px;
             cursor: pointer;
             white-space: nowrap;
             color: var(--text-color); /* Light text */
             font-weight: 500;
             background-color: #333; /* Darker background */
             border: 1px solid #555; /* Lighter border */
             transition: all 0.2s;
         }

         .category-bubble.active {
             border: 2px solid var(--primary-color);
             background-color: #20262c; /* Slightly lighter dark background for active */
             transform: scale(1.02);
         }

         .product-grid {
             display: grid;
             grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
             gap: 15px;
             padding: 15px;
         }

         .product-card {
             border: 1px solid #333; /* Dark mode border */
             border-radius: var(--border-radius);
             overflow: hidden;
             text-align: center;
             box-shadow: var(--box-shadow);
             cursor: pointer; /* Makes the entire card appear clickable */
             display: flex;
             flex-direction: column;
             justify-content: space-between;
             background-color: #20262c; /* Dark mode background */
             position: relative; /* Badge positioning context */
         }

         /* --- NEW: OFFER BADGE STYLE --- */
         .offer-badge {
             position: absolute;
             top: 10px;
             right: 10px;
             background-color: var(--danger-color); /* Red color for offers */
             color: white;
             padding: 4px 8px;
             border-radius: 4px;
             font-size: 0.75rem;
             font-weight: 600;
             z-index: 10; /* Ensures it is above the image */
             box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
             transform: rotate(5deg); /* Slight rotation for attention */
         }
         /* --- END NEW: OFFER BADGE STYLE --- */

         .product-card img {
             width: 100%;
             height: 150px;
             object-fit: cover;
         }

         .product-info {
             padding: 10px;
         }

         .product-info h3 {
             font-size: 1rem;
             margin-bottom: 5px;
         }
          .product-info .price {
             color: var(--primary-color);
             font-weight: 600;
         }

         /* Removed .product-actions CSS as the div is removed from the product grid cards */

         /* Request 2: Add to cart button style (Kept for Modal/Page) */
         .add-to-cart-btn {
             background-color: var(--primary-color);
             color: var(--dark-color); /* Dark text for orange button */
             border: none;
             padding: 6px 10px; /* Reduced padding */
             border-radius: 5px;
             cursor: pointer;
             font-size: 0.8rem;
             width: 100%; /* Made full width */
         }

         .add-to-wishlist-btn {
             background: none;
             border: none;
             font-size: 1.2rem;
             cursor: pointer;
             color: var(--secondary-color);
         }

         .add-to-wishlist-btn.active {
             color: var(--danger-color);
         }

         /* --- PRODUCT DETAIL PAGE STYLES (NEW) --- */
         #product-detail-page {
            /* Full page view, no fixed header/footer padding in content area */
            padding-bottom: 60px; /* Space for bottom nav */
         }
         #product-detail-page .page-header {
            position: sticky;
            top: 60px; /* Below the fixed main header */
            z-index: 500;
         }
         #product-detail-content {
             padding: 15px;
         }
         #product-detail-page .product-image-wrapper {
             max-width: 300px; /* Constrain image size */
             margin: 0 auto 15px;
         }
         #product-detail-page img {
             width: 100%;
             height: auto;
             border-radius: var(--border-radius);
             display: block;
         }

         #product-detail-page h2 {
             margin: 15px 0;
         }

         #product-detail-page .price {
             font-size: 1.5rem;
             color: var(--primary-color);
             font-weight: bold;
         }
         
         /* --- NEW STYLES FOR MARKDOWN GENERATED CONTENT (Used for Product Detail AND About Us) --- */
         #product-detail-content #product-description-container h3,
         #about-content-container h3 {
             margin-top: 20px;
             margin-bottom: 5px;
             font-size: 1.1rem;
             color: var(--text-color); 
             border-bottom: 1px solid #444;
             padding-bottom: 5px;
<!DOCTYPE html>
 <html lang="en">

 <head>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>rushikesh </title>

     <link rel="preconnect" href="https://fonts.googleapis.com">
     <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
     <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
     
     <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js"></script>

     <style>
         /* CSS Reset and Global Styles */
         :root {
             --primary-color: #FF9900; /* Amazon Orange for key actions */
             --secondary-color: #BBBBBB; /* Lighter gray for secondary text in dark mode */
             --success-color: #28a745;
             --danger-color: #dc3545;
             --light-color: #333333; /* Darker background for light elements in dark mode */
             --dark-color: #131921; /* Amazon Dark Blue/Black for header/primary background */
             --background-color: var(--dark-color); /* Main background is dark (Request 2) */
             --text-color: #f8f9fa; /* Near white text for dark mode */
             --font-family: 'Poppins', sans-serif;
             --box-shadow: 0 4px 6px rgba(255, 255, 255, 0.1); /* Adjusted shadow for dark mode */
             --border-radius: 8px;
         }

         * {
             margin: 0;
             padding: 0;
             box-sizing: border-box;
         }

         body {
             font-family: var(--font-family);
             background-color: var(--background-color); /* Dark Background */
             color: var(--text-color); /* Light Text */
             padding-top: 60px;
             /* Space for fixed header */
             padding-bottom: 60px;
             /* Space for fixed footer */
         }
         
         /* Adjust card/container backgrounds for contrast on dark body */
         .product-card, #profile .profile-card, #product-detail-page .page-header {
            background-color: #20262c; /* Slightly lighter dark color for elements */
            border-color: #444;
         }
         
         .categories, #search-input, #contact-form input, #contact-form textarea {
             background-color: #20262c;
             color: var(--text-color);
             border-color: #444;
         }
         
         input[type="text"], input[type="email"], input[type="password"], input[type="tel"], textarea {
             border: 1px solid #444;
         }
         
         /* --- ANIMATION (Request 1) --- */
         @keyframes pulse-animation {
             0% { transform: scale(1); opacity: 1; }
             50% { transform: scale(1.05); opacity: 0.8; }
             100% { transform: scale(1); opacity: 1; }
         }
         
         .header .logo.animated {
             animation: pulse-animation 2s infinite ease-in-out;
         }

         /* --- NEW: SCROLL ANIMATION CSS --- */
         @keyframes fadeIn {
             from {
                 opacity: 0;
                 transform: translateY(20px);
             }
             to {
                 opacity: 1;
                 transform: translateY(0);
             }
         }

         .product-card.hidden {
             opacity: 0;
             transition: opacity 0.5s ease-out, transform 0.5s ease-out;
         }

         .product-card.animate-scroll {
             animation: fadeIn 0.5s ease-out forwards;
         }
         /* --- END NEW SCROLL ANIMATION CSS --- */


         /* --- UTILITY CLASSES --- */
         .page {
             display: none;
             /* Ensure standard pages take up full height for the product detail view */
             min-height: calc(100vh - 60px); 
         }

         .page.active {
             display: block;
         }

         .modal {
             display: none;
             position: fixed;
             z-index: 1000;
             left: 0;
             top: 0;
             width: 100%;
             height: 100%;
             overflow: auto;
             background-color: rgba(0, 0, 0, 0.7); /* Darker backdrop */
             align-items: center;
             justify-content: center;
         }

         .modal.active {
             display: flex;
         }

         .modal-content {
             background-color: #fff; /* Modal content remains white for contrast */
             color: #111; /* Dark text on white modal background */
             padding: 20px;
             border-radius: var(--border-radius);
             box-shadow: var(--box-shadow);
             width: 90%;
             max-width: 500px;
             position: relative;
         }

         .modal-content h2, .modal-content h4, .modal-content p, .modal-content strong, .modal-content span {
            color: #111; /* Ensure dark text inside white modals */
         }


         .close-btn {
             position: absolute;
             top: 10px;
             right: 15px;
             font-size: 24px;
             font-weight: bold;
             cursor: pointer;
             color: var(--secondary-color);
         }

         button,
         .btn {
             padding: 10px 15px;
             border: none;
             background-color: var(--primary-color);
             color: var(--dark-color); /* Changed button text color to dark for contrast with orange */
             border-radius: 5px;
             cursor: pointer;
             font-family: var(--font-family);
             font-size: 1rem;
             transition: background-color 0.3s;
         }

         button:hover,
         .btn:hover {
             background-color: #e68a00; /* Darker orange on hover */
         }

         .btn-danger {
             background-color: var(--danger-color);
             color: white; /* Ensure danger button text is white */
         }

         .btn-danger:hover {
             background-color: #c82333;
         }

         input[type="text"],
         input[type="email"],
         input[type="password"],
         input[type="tel"], /* Added for phone number */
         textarea {
             width: 100%;
             padding: 10px;
             margin: 8px 0;
             display: inline-block;
             /* Adjusted for dark mode contrast */
             border: 1px solid #ccc;
             background-color: #fff;
             color: #111;
             border-radius: 4px;
             box-sizing: border-box;
             font-family: var(--font-family);
         }
         
         #search-input {
             border: 1px solid #444;
             background-color: #20262c;
             color: var(--text-color);
         }

         /* --- HEADER --- */
         .header {
             position: fixed;
             top: 0;
             left: 0;
             width: 100%;
             height: 60px;
             background-color: var(--dark-color); /* Changed to dark Amazon color */
             display: flex;
             justify-content: space-between;
             align-items: center;
             padding: 0 20px;
             box-shadow: var(--box-shadow);
             z-index: 999;
         }

         .header .logo {
             font-size: 1.5rem;
             font-weight: 600;
             color: white; /* Changed from var(--primary-color) to white for dark background */
         }

         .header .header-icons {
             display: flex;
             align-items: center;
             gap: 15px;
         }
         
         .header .search-icon, .header .cart-icon i {
             font-size: 1.2rem;
             cursor: pointer;
             color: white; /* Changed from var(--dark-color) to white for dark background */
         }
         .header .cart-icon {
            position: relative;
            text-decoration: none;
         }
         
         /* --- BOTTOM NAVIGATION --- */
         .bottom-nav {
             position: fixed;
             bottom: 0;
             left: 0;
             width: 100%;
             height: 60px;
             background-color: #20262c; /* Darker bottom nav */
             display: flex;
             justify-content: space-around;
             align-items: center;
             box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.5);
             z-index: 999;
         }

         .nav-item {
             display: flex;
             flex-direction: column;
             align-items: center;
             color: var(--secondary-color);
             text-decoration: none;
             position: relative;
         }

         .nav-item.active {
             color: var(--primary-color);
         }

         .nav-item i {
             font-size: 1.5rem;
         }

         .nav-item span {
             font-size: 0.7rem;
         }

         .badge {
             position: absolute;
             top: -5px;
             right: -10px;
             background-color: var(--danger-color);
             color: white;
             border-radius: 50%;
             padding: 2px 6px;
             font-size: 0.7rem;
             display: none;
             /* Hidden by default */
         }

         .badge.active {
             display: block;
         }

         /* --- HOME PAGE --- */
         #home .slider-container {
             width: 100%;
             height: 200px;
             position: relative;
             overflow: hidden;
             background: linear-gradient(45deg, #FF9900, #ffc866); /* Updated gradient to orange shades */
             margin-bottom: 20px;
         }

         .slider {
             display: flex;
             transition: transform 0.5s ease-in-out;
         }

         .slide {
             min-width: 100%;
             height: 200px;
         }

         .slide img {
             width: 100%;
             height: 100%;
             object-fit: cover;
         }

         .fallback-slide {
             display: flex;
             justify-content: center;
             align-items: center;
             color: white;
             font-size: 2rem;
             font-weight: 600;
         }

         .slider-nav {
             position: absolute;
             top: 50%;
             transform: translateY(-50%);
             background: rgba(0, 0, 0, 0.5);
             color: white;
             border: none;
             padding: 10px;
             cursor: pointer;
             z-index: 10;
         }

         .prev-slide {
             left: 10px;
         }

         .next-slide {
             right: 10px;
         }

         .categories {
             display: flex;
             overflow-x: auto;
             padding: 10px;
             gap: 10px;
             -ms-overflow-style: none;
             /* IE and Edge */
             scrollbar-width: none;
             /* Firefox */
         }

         .categories::-webkit-scrollbar {
             display: none;
         }

         /* Request 5: Category styling for non-button look */
         .category-bubble {
             padding: 8px 15px;
             border-radius: 20px;
             cursor: pointer;
             white-space: nowrap;
             color: var(--text-color); /* Light text */
             font-weight: 500;
             background-color: #333; /* Darker background */
             border: 1px solid #555; /* Lighter border */
             transition: all 0.2s;
         }

         .category-bubble.active {
             border: 2px solid var(--primary-color);
             background-color: #20262c; /* Slightly lighter dark background for active */
             transform: scale(1.02);
         }

         .product-grid {
             display: grid;
             grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
             gap: 15px;
             padding: 15px;
         }

         .product-card {
             border: 1px solid #333; /* Dark mode border */
             border-radius: var(--border-radius);
             overflow: hidden;
             text-align: center;
             box-shadow: var(--box-shadow);
             cursor: pointer; /* Makes the entire card appear clickable */
             display: flex;
             flex-direction: column;
             justify-content: space-between;
             background-color: #20262c; /* Dark mode background */
             position: relative; /* Badge positioning context */
         }

         /* --- NEW: OFFER BADGE STYLE --- */
         .offer-badge {
             position: absolute;
             top: 10px;
             right: 10px;
             background-color: var(--danger-color); /* Red color for offers */
             color: white;
             padding: 4px 8px;
             border-radius: 4px;
             font-size: 0.75rem;
             font-weight: 600;
             z-index: 10; /* Ensures it is above the image */
             box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
             transform: rotate(5deg); /* Slight rotation for attention */
         }
         /* --- END NEW: OFFER BADGE STYLE --- */

         .product-card img {
             width: 100%;
             height: 150px;
             object-fit: cover;
         }

         .product-info {
             padding: 10px;
         }

         .product-info h3 {
             font-size: 1rem;
             margin-bottom: 5px;
         }
          .product-info .price {
             color: var(--primary-color);
             font-weight: 600;
         }

         /* Removed .product-actions CSS as the div is removed from the product grid cards */

         /* Request 2: Add to cart button style (Kept for Modal/Page) */
         .add-to-cart-btn {
             background-color: var(--primary-color);
             color: var(--dark-color); /* Dark text for orange button */
             border: none;
             padding: 6px 10px; /* Reduced padding */
             border-radius: 5px;
             cursor: pointer;
             font-size: 0.8rem;
             width: 100%; /* Made full width */
         }

         .add-to-wishlist-btn {
             background: none;
             border: none;
             font-size: 1.2rem;
             cursor: pointer;
             color: var(--secondary-color);
         }

         .add-to-wishlist-btn.active {
             color: var(--danger-color);
         }

         /* --- PRODUCT DETAIL PAGE STYLES (NEW) --- */
         #product-detail-page {
            /* Full page view, no fixed header/footer padding in content area */
            padding-bottom: 60px; /* Space for bottom nav */
         }
         #product-detail-page .page-header {
            position: sticky;
            top: 60px; /* Below the fixed main header */
            z-index: 500;
         }
         #product-detail-content {
             padding: 15px;
         }
         #product-detail-page .product-image-wrapper {
             max-width: 300px; /* Constrain image size */
             margin: 0 auto 15px;
         }
         #product-detail-page img {
             width: 100%;
             height: auto;
             border-radius: var(--border-radius);
             display: block;
         }

         #product-detail-page h2 {
             margin: 15px 0;
         }

         #product-detail-page .price {
             font-size: 1.5rem;
             color: var(--primary-color);
             font-weight: bold;
         }
         
         /* --- NEW STYLES FOR MARKDOWN GENERATED CONTENT (Used for Product Detail AND About Us) --- */
         #product-detail-content #product-description-container h3,
         #about-content-container h3 {
             margin-top: 20px;
             margin-bottom: 5px;
             font-size: 1.1rem;
             color: var(--text-color); 
             border-bottom: 1px solid #444;
             padding-bottom: 5px;
         }
         #product-detail-content #product-description-container p,
         #about-content-container p {
             margin: 10px 0;
             line-height: 1.4;
         }
         #product-detail-content #product-description-container ul, 
         #product-detail-content #product-description-container ol,
         #about-content-container ul, 
         #about-content-container ol {
             margin: 10px 0 10px 20px;
             padding-left: 0;
             list-style-position: inside;
         }
         #product-detail-content #product-description-container li,
         #about-content-container li {
             margin-bottom: 5px;
             color: var(--secondary-color);
         }
         #product-detail-content #product-description-container strong, 
         #product-detail-content #product-description-container em,
         #about-content-container strong, 
         #about-content-container em {
             color: var(--text-color); /* Use light text color for emphasis */
         }
         /* --- END NEW STYLES --- */

         #product-detail-page .modal-actions { /* Renamed from modal-actions to page-actions if needed, but keeping for now */
             display: flex;
             gap: 10px;
         }

        /* --- PROFILE PAGE STYLES (Request 6) --- */
         #profile .profile-card {
            background-color: #20262c; /* Dark mode profile card */
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-top: 20px;
         }
         #profile .profile-info p {
            margin-bottom: 10px;
            border-bottom: 1px dashed #444; /* Dark mode dashed line */
            padding-bottom: 10px;
         }
         #profile .profile-info p:last-child {
            border-bottom: none;
            padding-bottom: 0;
         }
         #profile .profile-action-btn {
            margin-top: 15px;
            display: inline-block;
         }

         /* --- ORDER INVOICE STYLES (Request 4) --- */
         .order-detail-view {
             background-color: #333; /* Darker background for details */
             padding: 15px;
             margin-top: 10px;
             border-radius: 4px;
             border-left: 5px solid var(--primary-color);
             display: none; /* Hidden by default */
         }
         .order-detail-view h4 {
             margin-bottom: 10px;
             color: var(--primary-color);
         }
         .order-detail-view ul {
             list-style: none;
             padding: 0;
             margin-bottom: 10px;
         }
         .order-detail-view li {
             border-bottom: 1px solid #444; /* Dark mode border */
             padding: 5px 0;
             display: flex;
             justify-content: space-between;
         }
         .order-detail-view .shipping-info {
             font-size: 0.9rem;
             margin-top: 10px;
             padding-top: 10px;
             border-top: 1px solid #444;
         }
         /* Add a simple style for order cards */
         .order-card {
             border: 1px solid #444; /* Dark mode border */
             background-color: #20262c;
             padding: 15px;
             margin-bottom: 10px;
             border-radius: 8px;
             cursor: pointer;
             box-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
         }
         .order-card .order-header {
             display: flex;
             justify-content: space-between;
             font-weight: bold;
         }

         /* --- AUTH MODAL (for completeness) --- */
         #auth-modal .modal-content { max-width: 350px; }
         .auth-form-container { display: none; }
         .auth-form-container.active { display: block; }
         .auth-form-container button { margin-top: 10px; }
         #auth-error { color: var(--danger-color); text-align: center; margin-bottom: 10px; }

         /* --- MENU MODAL (for completeness) --- */
         #menu-modal .modal-content { max-width: 300px; padding: 0; }
         #main-menu-list { list-style: none; padding: 0; margin: 0; }
         #main-menu-list li a {
             display: block;
             padding: 15px 20px;
             text-decoration: none;
             color: #111; /* Dark text on white modal */
             border-bottom: 1px solid #eee;
         }
         #main-menu-list li:last-child a { border-bottom: none; }
         #main-menu-list li a i { margin-right: 10px; width: 20px; text-align: center; color: var(--primary-color); }
     </style>
 </head>

 <body>

     <header class="header">
         <div class="logo animated">shivani</div> <div class="header-icons">
             <i class="fas fa-search search-icon" data-hash="search"></i>
             <a href="#cart" class="nav-item cart-icon" style="color: white; text-decoration: none;"> <i class="fas fa-shopping-cart"></i>
                 <span id="cart-badge" class="badge">0</span>
             </a>
         </div>
     </header>

     <main>
         <section id="home" class="page active">
             <div class="slider-container">
                 <div class="slider">
                     </div>
                 <button class="slider-nav prev-slide"><i class="fas fa-chevron-left"></i></button>
                 <button class="slider-nav next-slide"><i class="fas fa-chevron-right"></i></button>
             </div>
             <div class="categories">
                 </div>
             <div id="product-grid" class="product-grid">
                 </div>
         </section>

         <section id="search" class="page">
             <input type="text" id="search-input" placeholder="Search for products...">
             <div id="search-results-grid" class="product-grid"></div>
         </section>

         <section id="wishlist" class="page">
             <div class="page-content">
                 <h1>My Wishlist</h1>
                 <div id="wishlist-container"></div>
             </div>
         </section>

         <section id="cart" class="page">
             <div class="page-content">
                 <h1>Shopping Cart</h1>
                 <div id="cart-container"></div>
             </div>
         </section>

         <section id="profile" class="page">
             <div class="page-content">
                 <h1>My Profile</h1>
                 <div class="profile-card">
                     <h2>User Information</h2>
                     <div class="profile-info">
                         <p><strong>Email:</strong> <span id="user-profile-email"></span></p>
                         <p><strong>Name:</strong> <span id="user-profile-name">Not Set</span></p>
                         <p><strong>Phone:</strong> <span id="user-profile-phone">Not Set</span></p>
                     </div>
                     <button class="btn profile-action-btn">Edit Profile</button>
                 </div>
             </div>
         </section>
         
         <section id="orders" class="page">
             <div class="page-content">
                 <h1>My Orders</h1>
                 <div id="orders-container"></div>
             </div>
         </section>
         
         <section id="about" class="page">
             <div class="page-content">
                 <h1>About Us</h1>
                 <div id="about-content-container">
                    <p>Content loading...</p>
                 </div>
             </div>
         </section>
         <section id="contact" class="page">
             <div class="page-content">
                 <h1>Contact Us</h1>
                 <form id="contact-form">
                     <input type="text" id="contact-name" placeholder="Your Name" required>
                     <input type="email" id="contact-email" placeholder="Your Email" required>
                     <textarea id="contact-message" placeholder="Your Message" rows="5" required></textarea>
                     <button type="submit">Send Message</button>
                 </form>
             </div>
         </section>
         
         <section id="product-detail-page" class="page">
             <div class="page-header" style="padding: 15px; display: flex; align-items: center; border-bottom: 1px solid #444;">
                 <i id="back-to-previous-page" class="fas fa-arrow-left" style="font-size: 1.2rem; cursor: pointer; margin-right: 15px;"></i>
                 <h2 id="product-detail-title" style="font-size: 1.2rem; margin: 0;">Product Details</h2>
             </div>
             <div id="product-detail-content">
                 </div>
         </section>
         </main>

     <footer class="bottom-nav">
         <a href="#home" class="nav-item active">
             <i class="fas fa-home"></i>
             <span>Home</span>
         </a>
         <a href="#wishlist" class="nav-item">
             <i class="fas fa-heart"></i>
             <span id="wishlist-badge" class="badge">0</span>
             <span>Wishlist</span>
         </a>
         <a href="#orders" class="nav-item"> <i class="fas fa-box"></i>
             <span>Orders</span>
         </a>
         <div id="menu-btn" class="nav-item">
             <i class="fas fa-bars"></i>
             <span>Menu</span>
         </div>
     </footer>

     
     <div id="auth-modal" class="modal">
         <div class="modal-content">
             <span class="close-btn">&times;</span>
             <div id="auth-error"></div>
             <div id="login-form-container" class="auth-form-container active">
                 <h2>Login</h2>
                 <form id="login-form">
                     <input type="email" id="login-email" placeholder="Email" required>
                     <input type="password" id="login-password" placeholder="Password" required>
                     <button type="submit">Login</button>
                 </form>
                 <button id="show-register">New User? Register</button>
             </div>
             <div id="register-form-container" class="auth-form-container">
                 <h2>Register</h2>
                 <form id="register-form">
                     <input type="email" id="register-email" placeholder="Email" required>
                     <input type="password" id="register-password" placeholder="Password" required>
                     <button type="submit">Register</button>
                 </form>
                 <button id="show-login">Already have an account? Login</button>
             </div>
         </div>
     </div>

     <div id="menu-modal" class="modal">
        <div class="modal-content">
            <ul id="main-menu-list">
                </ul>
        </div>
     </div>

     <div id="shipping-modal" class="modal">
         <div class="modal-content">
             <span class="close-btn">&times;</span>
             <h2>Shipping Details</h2>
             <form id="shipping-form">
                 <input type="text" id="shipping-name" placeholder="Full Name" required>
                 <input type="tel" id="shipping-phone" placeholder="Contact Number" required>
                 <textarea id="shipping-address" placeholder="Full Shipping Address" rows="4" required></textarea>
                 <button type="submit">Place Order</button>
             </form>
         </div>
     </div>


     <script type="module">
         // Import the functions you need from the SDKs you need
         import {
             initializeApp
         } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
         import {
             getAuth,
             onAuthStateChanged,
             createUserWithEmailAndPassword,
             signInWithEmailAndPassword,
             signOut
         } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
         import {
             getDatabase,
             ref,
             get,
             set,
             onValue,
             remove,
             push,
             child
         } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

         // IMPORTANT: Replace with your own Firebase project configuration
         const firebaseConfig = {
             apiKey: "AIzaSyBMxGk7u49JcwvMh6HOIUTgMwlYjcDxwIM",
             authDomain: "third-technique-457315-i1.firebaseapp.com",
             databaseURL: "https://third-technique-457315-i1-default-rtdb.firebaseio.com",
             projectId: "third-technique-457315-i1",
             storageBucket: "third-technique-457315-i1.firebasestorage.app",
             messagingSenderId: "17139707144",
             appId: "1:17139707144:web:c8fa79d55a99ac16c150bd",
             measurementId: "G-ZRVTN9RNNT"
         };

         // Initialize Firebase
         const app = initializeApp(firebaseConfig);
         const auth = getAuth(app);
         const db = getDatabase(app);
         
         // 2. INITIALIZE SHOWDOWN CONVERTER
         const converter = new showdown.Converter();

         let allProducts = [];
         let currentUser = null;
         let userCartRef = null;
         let userWishlistRef = null;
         
         const cartBadge = document.getElementById('cart-badge');
         const wishlistBadge = document.getElementById('wishlist-badge');
         const menuList = document.getElementById('main-menu-list');
         const modals = document.querySelectorAll('.modal');

         // --- NEW: SCROLL ANIMATION LOGIC ---
         const observer = new IntersectionObserver((entries, observer) => {
             entries.forEach(entry => {
                 if (entry.isIntersecting) {
                     // Apply the animation class when the element comes into view
                     entry.target.classList.add('animate-scroll');
                     // Stop observing once it's animated
                     observer.unobserve(entry.target);
                 }
             });
         }, {
             rootMargin: '0px',
             threshold: 0.1 // Trigger when 10% of the item is visible
         });

         const applyScrollAnimation = (containerId) => {
             // Select all newly rendered product cards
             document.querySelectorAll(`#${containerId} .product-card`).forEach(card => {
                 // Only observe cards that haven't been animated yet
                 if (!card.classList.contains('animate-scroll')) {
                     observer.observe(card);
                 }
             });
         }
         // --- END NEW SCROLL ANIMATION LOGIC ---


         // --- HELPER FUNCTIONS ---
         const showNotification = (message) => {
             const notification = document.createElement('div');
             notification.style.cssText = `
                 position: fixed;
                 bottom: 70px;
                 left: 50%;
                 transform: translateX(-50%);
                 background-color: var(--primary-color); /* Use primary color for notifications */
                 color: var(--dark-color);
                 padding: 10px 20px;
                 border-radius: 5px;
                 z-index: 1001;
                 font-size: 0.9rem;
                 opacity: 0;
                 transition: opacity 0.5s ease;
             `;
             notification.textContent = message;
             document.body.appendChild(notification);

             setTimeout(() => {
                 notification.style.opacity = 1;
             }, 10);

             setTimeout(() => {
                 notification.style.opacity = 0;
                 setTimeout(() => {
                     document.body.removeChild(notification);
                 }, 500);
             }, 3000);
         };

         const closeAllModals = () => {
             modals.forEach(modal => modal.classList.remove('active'));
         };

         const navigate = (hash) => {
             const targetId = hash.substring(1);
             const pages = document.querySelectorAll('.page');
             const navItems = document.querySelectorAll('.bottom-nav .nav-item');

             let activePageId = targetId;

             // 1. Check if it's a product detail page hash
             if (targetId.startsWith('product-detail-')) {
                activePageId = 'product-detail-page';
                const productId = targetId.split('-')[2];
                // If this page is navigated via back/forward, re-render content
                // Check if content is empty or showing a different product
                if (document.getElementById('product-detail-content').innerHTML === '' || 
                    !document.getElementById('product-detail-content').querySelector(`[data-product-id="${productId}"]`)) {
                        openProductDetailPage(productId, false); // Pass false to prevent re-navigation
                }
             }

             // 2. Toggle pages
             pages.forEach(p => p.classList.toggle('active', p.id === activePageId));
             
             // 3. Toggle bottom navigation items (only for main pages)
             // Only show 'active' for bottom nav items if they match the main page ID
             navItems.forEach(i => {
                const navHash = i.getAttribute('href');
                i.classList.toggle('active', navHash === hash || navHash === `#${activePageId}`);
             });


             // 4. Close all modals when navigating to any page
             document.querySelectorAll('.modal').forEach(m => m.classList.remove('active'));


             // Special handling for search: deactivate on navigation away
             if (activePageId !== 'search') {
                 document.getElementById('search-input').value = '';
                 document.getElementById('search-results-grid').innerHTML = '';
             }
             
             // Special handling for profile/orders/wishlist: require auth
             if (['profile', 'orders', 'wishlist'].includes(activePageId) && !currentUser) {
                 location.hash = '#home';
                 showNotification("Please log in to view this page.");
                 document.getElementById('auth-modal').classList.add('active');
             }
         };

         // --- AUTHENTICATION ---
         onAuthStateChanged(auth, (user) => {
             currentUser = user;
             updateUI(user);

             if (user) {
                 userCartRef = ref(db, `users/${user.uid}/cart`);
                 userWishlistRef = ref(db, `users/${user.uid}/wishlist`);

                 // Set up real-time listeners for authenticated user's data
                 onValue(userCartRef, (snapshot) => {
                     const cart = snapshot.val() || {};
                     updateCartUI(cart);
                 });

                 onValue(userWishlistRef, (snapshot) => {
                     const wishlist = snapshot.val() || {};
                     updateWishlistUI(wishlist);
                     updateProductCardWishlistButtons(wishlist);
                 });
                 
                 onValue(ref(db, `users/${user.uid}/profile`), (snapshot) => {
                     const profile = snapshot.val() || {};
                     document.getElementById('user-profile-email').textContent = user.email;
                     document.getElementById('user-profile-name').textContent = profile.name || 'Not Set';
                     document.getElementById('user-profile-phone').textContent = profile.phone || 'Not Set';
                 });
                 
                 onValue(ref(db, `orders`), (snapshot) => {
                     const allOrders = snapshot.val() || {};
                     const userOrders = allOrders[user.uid] || {};
                     renderOrders(userOrders);
                 });
                 
                 // Sync local data to Firebase after login
                 syncLocalDataToFirebase();
             } else {
                 // Update UI for logged-out state
                 updateCartUI(JSON.parse(localStorage.getItem('cart') || '{}'));
                 updateWishlistUI(JSON.parse(localStorage.getItem('wishlist') || '{}'));
                 updateProductCardWishlistButtons(JSON.parse(localStorage.getItem('wishlist') || '{}'));
             }
             
             // After UI update, re-render the current view if necessary (e.g., cart/wishlist)
             if (location.hash === '#cart') updateCartUI(currentUser ? undefined : JSON.parse(localStorage.getItem('cart') || '{}'));
             if (location.hash === '#wishlist') updateWishlistUI(currentUser ? undefined : JSON.parse(localStorage.getItem('wishlist') || '{}'));
         });

         const updateUI = (user) => {
             // 1. Update Menu
             menuList.innerHTML = `
                 ${user ? `
                     <li><a href="#profile"><i class="fas fa-user-circle"></i> Profile</a></li>
                     <li><a href="#orders"><i class="fas fa-box"></i> My Orders</a></li>
                     <li><a href="#" id="logout-btn"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
                 ` : `
                     <li><a href="#" id="login-menu-btn"><i class="fas fa-sign-in-alt"></i> Login/Register</a></li>
                 `}
                 <li><a href="#about"><i class="fas fa-info-circle"></i> About Us</a></li>
                 <li><a href="#contact"><i class="fas fa-envelope"></i> Contact Us</a></li>
             `;

             // 2. Attach menu button listeners
             document.getElementById('login-menu-btn')?.addEventListener('click', (e) => {
                 e.preventDefault();
                 closeModal(document.getElementById('menu-modal'));
                 openModal(document.getElementById('auth-modal'));
             });

             document.getElementById('logout-btn')?.addEventListener('click', (e) => {
                 e.preventDefault();
                 closeModal(document.getElementById('menu-modal'));
                 logoutUser();
             });
             
             // 3. Attach standard page navigation handlers for menu links
             document.querySelectorAll('#main-menu-list li a').forEach(link => {
                 link.addEventListener('click', () => {
                     closeModal(document.getElementById('menu-modal'));
                 });
             });
         };

         const loginUser = (email, password) => {
             document.getElementById('auth-error').textContent = '';
             signInWithEmailAndPassword(auth, email, password)
                 .then(() => closeModal(document.getElementById('auth-modal')))
                 .catch(error => {
                     document.getElementById('auth-error').textContent = error.message;
                 });
         };

         const registerUser = (email, password) => {
             document.getElementById('auth-error').textContent = '';
             createUserWithEmailAndPassword(auth, email, password)
                 .then(() => closeModal(document.getElementById('auth-modal')))
                 .catch(error => {
                     document.getElementById('auth-error').textContent = error.message;
                 });
         };

         const logoutUser = () => {
             signOut(auth)
                 .then(() => {
                     showNotification("Logged out successfully.");
                     location.hash = '#home';
                 })
                 .catch(error => console.error("Logout Error:", error));
         };

         // Attach Auth form handlers
         document.getElementById('login-form').addEventListener('submit', (e) => {
             e.preventDefault();
             // FIX: Access values directly using the input IDs
             const email = document.getElementById('login-email').value;
             const password = document.getElementById('login-password').value;
             loginUser(email, password);
         });

         document.getElementById('register-form').addEventListener('submit', (e) => {
             e.preventDefault();
             // FIX: Access values directly using the input IDs
             const email = document.getElementById('register-email').value;
             const password = document.getElementById('register-password').value;
             registerUser(email, password);
         });

         document.getElementById('show-register').addEventListener('click', () => {
             document.getElementById('login-form-container').classList.remove('active');
             document.getElementById('register-form-container').classList.add('active');
             document.getElementById('auth-error').textContent = '';
         });

         document.getElementById('show-login').addEventListener('click', () => {
             document.getElementById('register-form-container').classList.remove('active');
             document.getElementById('login-form-container').classList.add('active');
             document.getElementById('auth-error').textContent = '';
         });

         // --- DATA SYNCING (LOCAL <-> FIREBASE) ---
         const syncLocalDataToFirebase = async () => {
             if (!currentUser) return;

             const localCart = JSON.parse(localStorage.getItem('cart') || '{}');
             const localWishlist = JSON.parse(localStorage.getItem('wishlist') || '{}');

             // Sync Cart
             if (Object.keys(localCart).length > 0) {
                 const userCartSnapshot = await get(userCartRef);
                 const firebaseCart = userCartSnapshot.val() || {};

                 // Merge: prioritize local quantities, but combine if product exists in both
                 let mergedCart = { ...firebaseCart
                 };
                 Object.entries(localCart).forEach(([productId, item]) => {
                     if (mergedCart[productId]) {
                         mergedCart[productId].quantity += item.quantity;
                     } else {
                         mergedCart[productId] = item;
                     }
                 });

                 await set(userCartRef, mergedCart);
                 localStorage.removeItem('cart'); // Clear local storage after sync
                 showNotification("Local cart merged with your account!");
             }

             // Sync Wishlist
             if (Object.keys(localWishlist).length > 0) {
                 const userWishlistSnapshot = await get(userWishlistRef);
                 const firebaseWishlist = userWishlistSnapshot.val() || {};

                 // Simple merge: local items overwrite/add to firebase items
                 const mergedWishlist = { ...firebaseWishlist,
                     ...localWishlist
                 };

                 await set(userWishlistRef, mergedWishlist);
                 localStorage.removeItem('wishlist'); // Clear local storage after sync
                 showNotification("Local wishlist merged with your account!");
             }
         };

         // --- RENDERING & DISPLAY ---

         const renderSlider = (images) => {
             const slider = document.querySelector('#home .slider');
             if (images.length === 0) {
                 slider.innerHTML = `<div class="slide fallback-slide">No Slider Images</div>`;
                 return;
             }
             slider.innerHTML = images.map(imgUrl => `<div class="slide"><img src="${imgUrl}" alt="Slider Image"></div>`).join('');
             initSlider();
         };

         const renderCategories = (products) => {
             const categoriesContainer = document.querySelector('.categories');
             const uniqueCategories = ['All', ...new Set(products.map(p => p.category))];
             categoriesContainer.innerHTML = uniqueCategories.map(cat =>
                 `<div class="category-bubble ${cat === 'All' ? 'active' : ''}" data-category="${cat}">${cat}</div>`
             ).join('');

             // Set 'All' as active initially
             categoriesContainer.addEventListener('click', e => {
                 if (e.target.classList.contains('category-bubble')) {
                     document.querySelectorAll('.category-bubble').forEach(b => b.classList.remove('active'));
                     e.target.classList.add('active');
                     filterProducts(e.target.dataset.category);
                 }
             });
         };

         const renderProducts = (products, containerId) => {
             const grid = document.getElementById(containerId);
             if (!products || products.length === 0) {
                 grid.innerHTML = '<p>No products found.</p>';
                 return;
             }

             grid.innerHTML = products.map(p => {
                 // Using offerPercent from Admin (Request 9)
                 const finalPrice = p.offerPercent ? p.price * (1 - p.offerPercent / 100) : p.price;
                 
                 // NEW: Check if there's an active offer
                 const isOffer = p.offerPercent && p.offerPercent > 0;

                 return `
                 <div class="product-card hidden" data-product-id="${p.id}">
                     ${isOffer ? `<div class="offer-badge">${p.offerPercent}% OFF</div>` : ''} 
                     <img src="${p.imageUrl}" alt="${p.name}">
                     <div class="product-info">
                         <h3>${p.name}</h3>
                         <p class="price">
                             ${p.offerPercent ? `<del style="color:#dc3545; font-size:0.8rem;">$${parseFloat(p.price).toFixed(2)}</del> ` : ''}
                             $${parseFloat(finalPrice).toFixed(2)}
                         </p>
                     </div>
                 </div>
             `;
             }).join('');
             
             // NEW: Apply scroll animation after rendering
             if (containerId === 'product-grid' || containerId === 'search-results-grid') {
                 applyScrollAnimation(containerId);
             }
             
             // --- MODIFIED CLICK LISTENERS ---
             // Attach click listener to the entire product card to open the detail view
             document.querySelectorAll(`#${containerId} .product-card`).forEach(card => {
                 const productId = card.dataset.productId;
                 
                 // Listener for the entire card to open the detail modal
                 card.addEventListener('click', () => {
                     openProductDetailPage(productId);
                 });
                 // Removed listeners for: add-to-cart-btn and add-to-wishlist-btn
             });
             // --- END MODIFIED CLICK LISTENERS ---
         };

         const filterProducts = (category) => {
             const filtered = category === 'All' ? allProducts : allProducts.filter(p => p.category === category);
             renderProducts(filtered, 'product-grid');
         };

         // --- NEW PRODUCT DETAIL PAGE FUNCTION ---
         const openProductDetailPage = (productId, doNavigation = true) => { // Renamed from openProductDetailModal
             const product = allProducts.find(p => p.id === productId);
             if (!product) return;

             const finalPrice = product.offerPercent ? product.price * (1 - product.offerPercent / 100) : product.price;
             const pageContent = document.getElementById('product-detail-content');
             const pageTitle = document.getElementById('product-detail-title');
             
             pageTitle.textContent = product.name; // Set title in the header
             
             // 3. CONVERT MARKDOWN DESCRIPTION TO HTML
             const htmlDescription = converter.makeHtml(product.description || '');


             pageContent.innerHTML = `
                 <div class="product-image-wrapper">
                    <img src="${product.imageUrl}" alt="${product.name}" data-product-id="${product.id}">
                 </div>
                 <h2 style="font-size: 1.5rem;">${product.name}</h2>
                 <p class="price">
                     ${product.offerPercent ? `<del style="color:#dc3545; font-size:0.8rem; margin-right: 10px;">$${parseFloat(product.price).toFixed(2)}</del>` : ''}
                     $${parseFloat(finalPrice).toFixed(2)}
                 </p>
                 ${product.offerPercent && product.offerPercent > 0 ? `<p style="color:var(--success-color); font-weight: 600;">${product.offerPercent}% OFF</p>` : ''}
                 
                 <div id="product-description-container" data-product-id="${product.id}">
                     ${htmlDescription}
                 </div>
                 
                 <div class="modal-actions" style="margin-top: 20px;">
                     <button class="add-to-cart-btn" data-product-id="${productId}" style="flex-grow: 1;">Add to Cart</button>
                     <button class="add-to-wishlist-btn" data-product-id="${productId}"><i class="far fa-heart"></i></button>
                 </div>
             `;

             // Ensure wishlist button state is correct immediately
             updateWishlistUI(currentUser ? undefined : JSON.parse(localStorage.getItem('wishlist') || '{}'));
             
             // Re-attach page-specific listeners
             document.querySelector('#product-detail-page .add-to-cart-btn').addEventListener('click', (e) => handleAddToCart(e.target.dataset.productId));
             document.querySelector('#product-detail-page .add-to-wishlist-btn').addEventListener('click', (e) => handleToggleWishlist(e.target.dataset.productId));

             // Navigate to the new page hash (only if initiated by user click, not back/forward)
             if (doNavigation) {
                location.hash = `#product-detail-${productId}`;
             }
         };
         
         // Attach the back button listener for the product detail page
         document.getElementById('back-to-previous-page').addEventListener('click', () => {
            history.back();
         });
         // --- END NEW PRODUCT DETAIL PAGE FUNCTION ---


         const updateProductCardWishlistButtons = (wishlist) => {
             // Updates ALL product card wishlist button states based on the provided wishlist object
             document.querySelectorAll('.product-card .add-to-wishlist-btn').forEach(btn => {
                 const productId = btn.dataset.productId;
                 if (wishlist[productId]) {
                     btn.classList.add('active');
                     btn.querySelector('i').classList.replace('far', 'fas');
                 } else {
                     btn.classList.remove('active');
                     btn.querySelector('i').classList.replace('fas', 'far');
                 }
             });
             // Also update the button in the open product detail page
             const pageBtn = document.querySelector('#product-detail-page .add-to-wishlist-btn');
             if (pageBtn) {
                 const productId = pageBtn.dataset.productId;
                 if (wishlist[productId]) {
                     pageBtn.classList.add('active');
                     pageBtn.querySelector('i').classList.replace('far', 'fas');
                 } else {
                     pageBtn.classList.remove('active');
                     pageBtn.querySelector('i').classList.replace('fas', 'far');
                 }
             }
         };

         // --- CART LOGIC ---
         const handleAddToCart = async (productId) => {
             const product = allProducts.find(p => p.id === productId);
             if (!product) return;

             // Logic to get the current cart, either from Firebase or Local Storage
             let currentCart;
             if (currentUser) {
                 const snapshot = await get(userCartRef);
                 currentCart = snapshot.val() || {};
             } else {
                 currentCart = JSON.parse(localStorage.getItem('cart') || '{}');
             }

             // Add or increment quantity
             if (currentCart[productId]) {
                 currentCart[productId].quantity += 1;
             } else {
                 currentCart[productId] = {
                     ...product,
                     quantity: 1
                 };
             }

             // Logic to save the updated cart
             if (currentUser) {
                 await set(userCartRef, currentCart);
             } else {
                 localStorage.setItem('cart', JSON.stringify(currentCart));
                 updateCartUI(currentCart); // Update UI manually for local storage
             }
             
             showNotification(`${product.name} added to cart!`);
         };

         const handleUpdateCartQuantity = async (productId, action) => {
             let currentCart;
             if (currentUser) {
                 const snapshot = await get(userCartRef);
                 currentCart = snapshot.val() || {};
             } else {
                 currentCart = JSON.parse(localStorage.getItem('cart') || '{}');
             }

             if (!currentCart[productId]) return;

             if (action === 'increase') {
                 currentCart[productId].quantity += 1;
             } else if (action === 'decrease') {
                 currentCart[productId].quantity -= 1;
                 if (currentCart[productId].quantity <= 0) {
                     delete currentCart[productId]; // Remove if quantity drops to 0 or less
                 }
             }

             if (currentUser) {
                 await set(userCartRef, currentCart);
             } else {
                 localStorage.setItem('cart', JSON.stringify(currentCart));
                 updateCartUI(currentCart);
             }
         };

         const handleRemoveFromCart = async (productId) => {
             let currentCart;
             if (currentUser) {
                 const snapshot = await get(userCartRef);
                 currentCart = snapshot.val() || {};
             } else {
                 currentCart = JSON.parse(localStorage.getItem('cart') || '{}');
             }
             
             const product = currentCart[productId] || allProducts.find(p => p.id === productId);
             if (!product) return;

             if (currentCart[productId]) {
                 delete currentCart[productId];
             }

             if (currentUser) {
                 await set(userCartRef, currentCart);
             } else {
                 localStorage.setItem('cart', JSON.stringify(currentCart));
                 updateCartUI(currentCart);
             }
             showNotification(`${product.name} removed from cart.`);
         };


         const updateCartUI = (cartData) => {
             const cartContainer = document.getElementById('cart-container');
             const cartBadge = document.getElementById('cart-badge');

             const cart = cartData || {}; // If cartData is undefined (Firebase context), use the already fetched one
             let cartHTML = '';
             let subtotalPrice = 0;
             let totalItems = 0;

             if (Object.keys(cart).length === 0) {
                 cartHTML = `<p style="text-align: center; margin-top: 20px;">Your cart is empty.</p>`;
                 cartContainer.innerHTML = cartHTML;
                 cartBadge.textContent = 0;
                 cartBadge.classList.remove('active');
                 return;
             }

             Object.entries(cart).forEach(([productId, item]) => {
                 const product = allProducts.find(p => p.id === productId);

                 if (product) {
                     // Apply offer discount
                     const finalPrice = product.offerPercent ? product.price * (1 - product.offerPercent / 100) : product.price;
                     const itemSubtotal = finalPrice * item.quantity;
                     subtotalPrice += itemSubtotal;
                     totalItems += item.quantity;

                     cartHTML += `
                         <div style="display: flex; gap: 15px; margin-bottom: 15px; border-bottom: 1px solid #444; padding-bottom: 10px;">
                             <img src="${item.imageUrl}" alt="${item.name}" style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">
                             <div style="flex-grow: 1;">
                                 <h4 style="margin-top: 0;">${item.name}</h4>
                                 <p style="color: var(--primary-color); font-weight: 600;">$${finalPrice.toFixed(2)} x ${item.quantity} = $${itemSubtotal.toFixed(2)}</p>
                             </div>
                             <div style="display: flex; flex-direction: column; align-items: flex-end; justify-content: space-between;">
                                 <button class="btn-danger remove-from-cart-btn" data-product-id="${productId}" style="padding: 5px 10px; font-size: 0.8rem;">Remove</button>
                                 <div style="display: flex; align-items: center; gap: 5px; margin-top: 10px;">
                                     <button class="btn update-quantity-btn" data-product-id="${productId}" data-action="decrease" style="padding: 5px; font-size: 0.8rem; background-color: #ccc; color: var(--dark-color); width: 30px;">-</button>
                                     <span style="font-weight: 500;">${item.quantity}</span>
                                     <button class="btn update-quantity-btn" data-product-id="${productId}" data-action="increase" style="padding: 5px; font-size: 0.8rem; width: 30px;">+</button>
                                 </div>
                             </div>
                         </div>
                     `;
                 }
             });

             // Temporarily calculate estimated GST amount for cart view
             let totalGSTAmountEstimate = 0;
             Object.entries(cart).forEach(([productId, item]) => {
                 const product = allProducts.find(p => p.id === productId);
                 if (product) {
                     const priceAfterDiscount = product.offerPercent ? product.price * (1 - product.offerPercent / 100) : product.price;
                     const gstRate = product.gstRate || 0;
                     const unitGSTAmount = priceAfterDiscount * (gstRate / 100);
                     totalGSTAmountEstimate += unitGSTAmount * item.quantity;
                 }
             });

             const finalTotalEstimate = subtotalPrice + totalGSTAmountEstimate;

             cartHTML += `
                 <div style="margin-top: 20px; padding-top: 15px; border-top: 2px solid var(--primary-color);">
                     <p>Subtotal: $${subtotalPrice.toFixed(2)}</p>
                     <p>Est. GST: $${totalGSTAmountEstimate.toFixed(2)}</p>
                     <h3>Total: $${finalTotalEstimate.toFixed(2)}</h3>
                     <p style="font-size: 0.9rem; color: var(--secondary-color);">Total Items: ${totalItems}</p>
                     <button id="checkout-btn" class="btn" style="margin-top: 15px;">Checkout</button>
                 </div>
             `;
             
             cartContainer.innerHTML = cartHTML;
             cartBadge.textContent = totalItems;
             cartBadge.classList.add('active');
             
             // Attach listeners after rendering
             document.querySelectorAll('.remove-from-cart-btn').forEach(btn => {
                 btn.addEventListener('click', () => handleRemoveFromCart(btn.dataset.productId));
             });

             document.querySelectorAll('.update-quantity-btn').forEach(btn => {
                 btn.addEventListener('click', () => handleUpdateCartQuantity(btn.dataset.productId, btn.dataset.action));
             });

             document.getElementById('checkout-btn').addEventListener('click', () => {
                 if (!currentUser) {
                     showNotification("Please log in to proceed to checkout.");
                     openModal(document.getElementById('auth-modal'));
                     return;
                 }
                 
                 // Open shipping modal
                 openModal(document.getElementById('shipping-modal'));
             });
         };

         // --- WISHLIST LOGIC ---
         const handleToggleWishlist = async (productId) => {
             const product = allProducts.find(p => p.id === productId);
             if (!product) return;

             if (!currentUser) {
                 // Local Storage logic for guests
                 let localWishlist = JSON.parse(localStorage.getItem('wishlist') || '{}');
                 if (localWishlist[productId]) {
                     delete localWishlist[productId];
                     showNotification(`${product.name} removed from wishlist.`);
                 } else {
                     localWishlist[productId] = {
                         ...product
                     };
                     showNotification(`${product.name} added to wishlist!`);
                 }
                 localStorage.setItem('wishlist', JSON.stringify(localWishlist));
                 updateWishlistUI(localWishlist);
                 updateProductCardWishlistButtons(localWishlist); // Update all relevant buttons
             } else {
                 // Firebase logic for logged-in users
                 const snapshot = await get(child(userWishlistRef, productId));
                 if (snapshot.exists()) {
                     await remove(child(userWishlistRef, productId));
                     showNotification(`${product.name} removed from wishlist.`);
                 } else {
                     await set(child(userWishlistRef, productId), {
                         ...product
                     });
                     showNotification(`${product.name} added to wishlist!`);
                 }
                 // Real-time listener handles UI update
             }
         };

         const handleRemoveFromWishlist = (productId) => {
             if (!currentUser) return; // Handled by handleToggleWishlist for guests

             const product = allProducts.find(p => p.id === productId);
             if (!product) return;
             
             remove(ref(db, `users/${currentUser.uid}/wishlist/${productId}`));
             showNotification(`${product.name} removed from wishlist.`);
         }
         
         const handleMoveToCart = async (productId) => {
             await handleAddToCart(productId);
             handleRemoveFromWishlist(productId);
         }

         const updateWishlistUI = (wishlistData) => {
             const wishlistContainer = document.getElementById('wishlist-container');
             const wishlistBadge = document.getElementById('wishlist-badge');

             const wishlist = wishlistData || {};
             let wishlistHTML = '';
             let totalItems = 0;

             if (Object.keys(wishlist).length === 0) {
                 wishlistHTML = `<p style="text-align: center; margin-top: 20px;">Your wishlist is empty.</p>`;
                 wishlistContainer.innerHTML = wishlistHTML;
                 wishlistBadge.textContent = 0;
                 wishlistBadge.classList.remove('active');
                 return;
             }

             Object.entries(wishlist).forEach(([productId, item]) => {
                 // Apply offer discount
                 const finalPrice = item.offerPercent ? item.price * (1 - item.offerPercent / 100) : item.price;
                 totalItems += 1;

                 wishlistHTML += `
                     <div style="display: flex; gap: 15px; margin-bottom: 15px; border-bottom: 1px solid #444; padding-bottom: 10px; align-items: center;">
                         <img src="${item.imageUrl}" alt="${item.name}" style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">
                         <div style="flex-grow: 1;">
                             <h4 style="margin-top: 0;">${item.name}</h4>
                             <p style="color: var(--primary-color); font-weight: 600;">
                                 ${item.offerPercent ? `<del style="color:#dc3545; font-size:0.8rem; margin-right: 5px;">$${parseFloat(item.price).toFixed(2)}</del>` : ''}
                                 $${parseFloat(finalPrice).toFixed(2)}
                             </p>
                         </div>
                         <div class="action-btns" style="display: flex; flex-direction: column; gap: 5px; align-items: flex-end;">
                             <button class="btn move-to-cart-btn" data-product-id="${productId}" style="background-color: var(--success-color); padding: 5px 10px; font-size: 0.8rem; color: white;">Move to Cart</button>
                             <button class="btn-danger remove-from-wishlist-btn" data-product-id="${productId}" style="padding: 5px 10px; font-size: 0.8rem;">Remove</button>
                         </div>
                     </div>
                 `;
             });

             wishlistContainer.innerHTML = wishlistHTML;
             wishlistBadge.textContent = totalItems;
             wishlistBadge.classList.add('active');
             
             // Attach listeners after rendering
             document.querySelectorAll('.move-to-cart-btn').forEach(btn => {
                 btn.addEventListener('click', () => handleMoveToCart(btn.dataset.productId));
             });

             document.querySelectorAll('.remove-from-wishlist-btn').forEach(btn => {
                 btn.addEventListener('click', () => handleRemoveFromWishlist(btn.dataset.productId));
             });
             
             updateProductCardWishlistButtons(wishlist); // Update product grid buttons too
         };
         
         // --- ORDER MANAGEMENT ---
         const renderOrders = (orders) => {
             const container = document.getElementById('orders-container');
             if (Object.keys(orders).length === 0) {
                 container.innerHTML = `<p style="text-align: center; margin-top: 20px;">You have not placed any orders yet.</p>`;
                 return;
             }

             // Sort orders by date descending
             container.innerHTML = Object.values(orders).sort((a, b) => b.date - a.date).map(order => `
                 <div class="order-card" data-order-id="${order.orderId}">
                     <div class="order-header">
                         <span>Order ID: ${order.orderId.slice(-8)}</span>
                         <span>${new Date(order.date).toLocaleDateString()}</span>
                     </div>
                     <div class="order-body">
                         <p>Total: $${order.totalAmount.toFixed(2)}</p>
                         <p>Status: <span class="order-status ${order.status}">${order.status}</span></p>
                     </div>
                     <div class="order-detail-view" id="details-${order.orderId}">
                         <h4>Order Details (Invoice)</h4>
                         <ul>
                             ${order.items.map(item => {
                                 // Use priceWithGST if available, otherwise calculate discounted price
                                 const priceToDisplay = item.priceWithGST || (item.price * (1 - (item.offerPercent || 0) / 100));
                                 return `
                                     <li>
                                         <span>${item.name} (x${item.quantity})</span>
                                         <span>$${(priceToDisplay * item.quantity).toFixed(2)}</span>
                                     </li>
                                 `;
                             }).join('')}
                         </ul>
                         <div class="shipping-info">
                             <p><strong>Subtotal (Before Tax):</strong> $${(order.subtotal || 0).toFixed(2)}</p>
                             <p><strong>Total GST:</strong> $${(order.totalGSTAmount || 0).toFixed(2)}</p>
                             <p style="font-weight: bold; border-top: 1px solid #ddd; padding-top: 5px;"><strong>Order Total:</strong> $${order.totalAmount.toFixed(2)}</p>
                             <br>
                             <p><strong>Shipping To:</strong> ${order.shippingName}</p>
                             <p><strong>Contact:</strong> ${order.shippingPhone || 'N/A'}</p>
                             <p><strong>Address:</strong> ${order.shippingAddress}</p>
                         </div>
                     </div>
                 </div>
             `).join('');

             // Add click listener to order cards to toggle details
             document.querySelectorAll('.order-card').forEach(card => {
                 card.addEventListener('click', (e) => {
                     const detailView = document.getElementById(`details-${card.dataset.orderId}`);
                     // Only toggle if the click wasn't on an internal link/button (though none exist here)
                     if (!e.target.closest('a, button')) {
                         detailView.style.display = detailView.style.display === 'block' ? 'none' : 'block';
                     }
                 });
             });
         };
         
         // --- CHECKOUT AND ORDER PLACEMENT ---
         document.getElementById('shipping-form').addEventListener('submit', async (e) => {
             e.preventDefault();

             if (!currentUser) {
                 showNotification("You must be logged in to place an order.");
                 return;
             }
             
             const shippingName = document.getElementById('shipping-name').value;
             const shippingPhone = document.getElementById('shipping-phone').value;
             const shippingAddress = document.getElementById('shipping-address').value;

             const cartSnapshot = await get(userCartRef);
             const cart = cartSnapshot.val() || {};
             if (Object.keys(cart).length === 0) {
                 showNotification("Your cart is empty. Cannot place an order.");
                 return;
             }

             let items = [];
             let subtotal = 0;
             let totalGSTAmount = 0;

             // Calculate final totals and prepare order items array
             for (const productId in cart) {
                 const item = cart[productId];
                 const product = allProducts.find(p => p.id === productId);

                 if (product) {
                     // Price after discount (Subtotal component per unit)
                     const priceAfterDiscount = product.offerPercent ? product.price * (1 - product.offerPercent / 100) : product.price;
                     
                     // GST calculation
                     const gstRate = product.gstRate || 0;
                     const unitGSTAmount = priceAfterDiscount * (gstRate / 100);
                     const itemTotalGST = unitGSTAmount * item.quantity;
                     
                     // Price per unit INCLUDING GST for invoice display
                     const priceWithGST = priceAfterDiscount + unitGSTAmount;

                     const itemSubtotal = priceAfterDiscount * item.quantity;

                     items.push({
                         productId: productId,
                         name: item.name,
                         imageUrl: item.imageUrl,
                         quantity: item.quantity,
                         price: product.price, // Original price
                         offerPercent: product.offerPercent,
                         gstRate: gstRate,
                         priceWithGST: priceWithGST, // Price per unit with GST
                     });

                     subtotal += itemSubtotal;
                     totalGSTAmount += itemTotalGST;
                 }
             }
             
             // Final total amount including GST
             const finalTotalAmount = subtotal + totalGSTAmount;


             try {
                 const newOrderRef = push(child(ref(db, 'orders'), currentUser.uid));
                 const orderData = {
                     orderId: newOrderRef.key,
                     date: Date.now(),
                     userEmail: currentUser.email,
                     items,
                     subtotal: subtotal, // NEW: Store subtotal (price before tax)
                     totalGSTAmount: totalGSTAmount, // NEW: Store total GST amount
                     totalAmount: finalTotalAmount, // UPDATED: Store final total (Subtotal + GST)
                     status: 'Pending',
                     shippingName,
                     shippingAddress,
                     shippingPhone,
                 };

                 await set(newOrderRef, orderData);
                 await remove(userCartRef); // Clear cart

                 closeModal(document.getElementById('shipping-modal'));
                 showNotification('Order placed successfully! Check My Orders for details.');
                 location.hash = '#orders';
                 
                 // Save phone number to user profile
                 await set(ref(db, `users/${currentUser.uid}/profile/phone`), shippingPhone);
                 
             } catch (error) {
                 console.error("Order placement error:", error);
                 showNotification("Failed to place order.");
             }
         });
         
         // --- SLIDER LOGIC ---
         let currentSlide = 0;
         let slideInterval;
         
         const initSlider = () => {
             const slides = document.querySelectorAll('#home .slide');
             const sliderContainer = document.querySelector('#home .slider-container');
             if (slides.length <= 1) {
                 sliderContainer.querySelector('.prev-slide').style.display = 'none';
                 sliderContainer.querySelector('.next-slide').style.display = 'none';
                 return;
             }
             
             // Clear previous interval
             if (slideInterval) clearInterval(slideInterval);
             
             const slider = document.querySelector('#home .slider');
             const nextBtn = document.querySelector('#home .next-slide');
             const prevBtn = document.querySelector('#home .prev-slide');

             const goToSlide = (slideIndex) => {
                 currentSlide = (slideIndex + slides.length) % slides.length;
                 slider.style.transform = `translateX(-${currentSlide * 100}%)`;
             };

             const next = () => {
                 goToSlide(currentSlide + 1);
             };

             const prev = () => {
                 goToSlide(currentSlide - 1);
             };

             nextBtn.addEventListener('click', next);
             prevBtn.addEventListener('click', prev);

             // Auto-slide every 5 seconds
             slideInterval = setInterval(next, 5000);
         };

         // --- EVENT LISTENERS & APP INITIALIZATION ---

         // Hashchange listener for navigation
         window.addEventListener('hashchange', () => navigate(location.hash));
         window.addEventListener('DOMContentLoaded', () => {
             if (!location.hash) location.hash = '#home';
             navigate(location.hash);
         });

         // Modal close button handlers
         document.querySelectorAll('.modal .close-btn').forEach(btn => {
             btn.addEventListener('click', closeAllModals);
         });

         // Modal backdrop click to close
         modals.forEach(modal => {
             modal.addEventListener('click', e => {
                 if (e.target === modal) {
                     closeModal(modal);
                 }
             });
         });

         const openModal = (modalElement) => {
             modalElement.classList.add('active');
         }

         const closeModal = (modalElement) => {
             modalElement.classList.remove('active');
         }

         // Menu button
         document.getElementById('menu-btn').addEventListener('click', () => {
             openModal(document.getElementById('menu-modal'));
         });
         
         // Search icon handler (in header)
         document.querySelector('.header .search-icon').addEventListener('click', () => {
             location.hash = '#search';
         });

         // Search input handler - MODIFIED FOR EXACT MATCH PRIORITY
         document.getElementById('search-input').addEventListener('input', (e) => {
             const searchTerm = e.target.value.toLowerCase().trim();
             
             if (searchTerm.length === 0) { 
                 renderProducts([], 'search-results-grid'); 
                 return;
             }

             //  ''      , ,    
             //  "iphone 17 pro"  "iphone17pro"       
             const cleanSearchTerm = searchTerm.replace(/[^a-z0-9]/g, '');

             // 1. Filter products that include the search term
             let filtered = allProducts.filter(p => {
                 //     
                 const cleanProductName = p.name.toLowerCase().replace(/[^a-z0-9]/g, '');

                 //          (   ),
                 //           (   )
                 return p.name.toLowerCase().includes(searchTerm) || cleanProductName.includes(cleanSearchTerm);
             });

             // 2. Sort the filtered products (Exact match, Starts with, then Clean Match)
             filtered.sort((a, b) => {
                 const aName = a.name.toLowerCase();
                 const bName = b.name.toLowerCase();
                 const aCleanName = aName.replace(/[^a-z0-9]/g, '');
                 const bCleanName = bName.replace(/[^a-z0-9]/g, '');
                 
                 // Priority 1: Exact Match (Case/Space/Special Character Ignored)
                 const aIsExactCleanMatch = aCleanName === cleanSearchTerm;
                 const bIsExactCleanMatch = bCleanName === cleanSearchTerm;
                 
                 if (aIsExactCleanMatch && !bIsExactCleanMatch) return -1; // 'a' 
                 if (!aIsExactCleanMatch && bIsExactCleanMatch) return 1;  // 'b' 

                 // Priority 2: Starts with the clean search term (Flexible Start)
                 const aCleanStarts = aCleanName.startsWith(cleanSearchTerm);
                 const bCleanStarts = bCleanName.startsWith(cleanSearchTerm);

                 if (aCleanStarts && !bCleanStarts) return -1;
                 if (!aCleanStarts && bCleanStarts) return 1;

                 // Priority 3: Otherwise, sort alphabetically by name (default)
                 return aName.localeCompare(bName);
             });
             
             // 3. Render the sorted list
             renderProducts(filtered, 'search-results-grid');
         });
         
         // Contact form handler
         document.getElementById('contact-form').addEventListener('submit', async (e) => {
             e.preventDefault();
             const name = document.getElementById('contact-name').value;
             const email = document.getElementById('contact-email').value;
             const message = document.getElementById('contact-message').value;

             try {
                 const newMessageRef = push(ref(db, 'messages'));
                 await set(newMessageRef, {
                     date: Date.now(),
                     name,
                     email,
                     message
                 });
                 showNotification("Message sent successfully! We will get back to you soon.");
                 e.target.reset();
             } catch (error) {
                 console.error("Error sending message:", error);
                 showNotification("Failed to send message. Please try again.");
             }
         });
         
         // Edit Profile button handler
         document.querySelector('#profile .profile-action-btn').addEventListener('click', () => {
             showNotification("Profile editing functionality to be implemented.");
         });

         // --- CORE LOGIC FUNCTIONS ---
         const initApp = async () => {
             try {
                 const productsSnapshot = await get(ref(db, 'products'));
                 if (productsSnapshot.exists()) {
                     allProducts = Object.entries(productsSnapshot.val()).map(([id, data]) => ({
                         id,
                         ...data
                     }));
                     renderProducts(allProducts, 'product-grid');
                     renderCategories(allProducts);
                 }

                 const sliderSnapshot = await get(ref(db, 'sliderImages'));
                 if (sliderSnapshot.exists()) {
                     renderSlider(Object.values(sliderSnapshot.val()));
                 } else {
                     renderSlider([]);
                 }
                 
                 // Load About Us Content - MODIFIED TO USE MARKDOWN CONVERTER AND NEW DIV
                 onValue(ref(db, 'content/about'), (snapshot) => {
                     const aboutContent = snapshot.val();
                     const container = document.getElementById('about-content-container');
                     if (aboutContent && aboutContent.text) {
                         container.innerHTML = converter.makeHtml(aboutContent.text);
                     } else {
                         container.innerHTML = "<p>Content coming soon!</p>";
                     }
                 }, { onlyOnce: true });

             } catch (error) {
                 console.error("Error loading initial data:", error);
             }
         };

         initApp();
     </script>
 </body>

 </html>
