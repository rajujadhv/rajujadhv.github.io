<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Rushikesh Electronics</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Rozha+One&family=Yantramanav:wght@700;900&display=swap" rel="stylesheet">
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js"></script>

    <style>
        /* --- THEME --- */
        :root {
            --primary: #2563eb; --accent: #FFD700; --bg: #F3F4F6; --white: #ffffff; --text: #1f2937;
            --radius: 12px; --danger: #ef4444; --success: #10b981; --header-bg: #111;
        }
        * { margin:0; padding:0; box-sizing:border-box; font-family:'Poppins', sans-serif; -webkit-tap-highlight-color:transparent; user-select:none; }
        
        /* FIX FOR MOBILE VIEWPORT */
        body { background: var(--bg); color: var(--text); height: 100vh; height: 100dvh; overflow: hidden; width: 100vw; }

        /* --- ANIMATED LOGO CSS --- */
        .logo-wrapper { display: flex; align-items: center; gap: 8px; }
        
        .logo-icon { 
            width: 45px; height: 45px; 
            background: #fff; border-radius: 10px; 
            box-shadow: 0 4px 10px rgba(255,255,255,0.2); border: 2px solid #ff6b00; 
            overflow: hidden; position: relative;
        }

        .logo-slider {
            display: flex; flex-direction: column;
            animation: slideLogo 8s infinite cubic-bezier(0.4, 0, 0.2, 1);
        }

        .logo-slider i {
            width: 41px; height: 41px; 
            display: flex; align-items: center; justify-content: center;
            font-size: 1.4rem; color: #ff6b00; flex-shrink: 0;
        }

        @keyframes slideLogo {
            0%, 20% { transform: translateY(0); }           /* TV */
            25%, 45% { transform: translateY(-41px); }      /* AC */
            50%, 70% { transform: translateY(-82px); }      /* Fan */
            75%, 95% { transform: translateY(-123px); }     /* Bolt */
            100% { transform: translateY(0); }
        }

        .logo-text-group { display: flex; flex-direction: column; line-height: 0.9; }
        .txt-main { font-family: 'Rozha One', serif; font-size: 1.1rem; color: #ff6b00; text-shadow: 1px 1px 0 #000; }
        .txt-sub { font-family: 'Yantramanav', sans-serif; font-size: 0.7rem; font-weight: 900; color: #00cc00; }
        .txt-small { font-family: 'Yantramanav', sans-serif; font-size: 0.5rem; font-weight: 700; color: #ccc; text-transform: uppercase; }

        /* --- APP SHELL --- */
        .app-shell { display: flex; flex-direction: column; height: 100%; width: 100%; }
        
        /* HEADER */
        .header { 
            height: 70px; background: var(--header-bg); display: flex; align-items: center; 
            justify-content: space-between; padding: 0 16px; flex-shrink: 0; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.3); z-index: 50; 
        }
        
        .content { 
            flex: 1; overflow-y: auto; overflow-x: hidden; 
            padding-bottom: 20px; scroll-behavior: smooth; 
        }

        /* FOOTER NAV */
        .nav { 
            height: auto; min-height: 70px; background: var(--white); 
            border-top: 1px solid #eee; display: flex; 
            justify-content: space-around; align-items: center; 
            flex-shrink: 0; padding-top: 10px; 
            padding-bottom: max(10px, env(safe-area-inset-bottom)); 
            z-index: 100; box-shadow: 0 -5px 20px rgba(0,0,0,0.02);
        }
        
        .nav-item { display: flex; flex-direction: column; align-items: center; font-size: 0.65rem; color: #9ca3af; text-decoration: none; transition: 0.3s; width: 100%; }
        .nav-item.active { color: var(--primary); transform: translateY(-3px); }
        .nav-item i { font-size: 1.4rem; margin-bottom: 3px; }

        .page { display: none; padding: 15px; animation: fadeIn 0.3s ease; } .page.active { display: block; }
        @keyframes fadeIn { from{opacity:0;transform:translateY(10px);} to{opacity:1;transform:translateY(0);} }

        /* COMPONENTS */
        .slider { height: 180px; background: #e5e7eb; border-radius: var(--radius); overflow: hidden; margin-bottom: 20px; position: relative; }
        .track { display: flex; height: 100%; transition: 0.5s; }
        .cats { display: flex; gap: 15px; overflow-x: auto; margin: 0 -15px 20px -15px; padding: 0 15px; scrollbar-width: none; }
        .cat-item { display: flex; flex-direction: column; align-items: center; min-width: 70px; }
        .cat-icon { width: 55px; height: 55px; background: var(--white); border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 1.3rem; color: var(--primary); box-shadow: 0 2px 8px rgba(0,0,0,0.05); margin-bottom: 5px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .card { background: var(--white); border-radius: var(--radius); overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.03); position: relative; transition: 0.2s; }
        .card:active { transform: scale(0.98); }
        .card-img { width: 100%; padding-top: 100%; position: relative; border-bottom: 1px solid #f3f3f3; }
        .card-img img { position: absolute; top: 10%; left: 10%; width: 80%; height: 80%; object-fit: contain; }
        .off-badge { position: absolute; top: 8px; left: 8px; background: #ef4444; color: white; font-size: 0.6rem; font-weight: bold; padding: 3px 8px; border-radius: 6px; z-index: 2; }
        .card-info { padding: 10px; }
        .card-title { font-size: 0.85rem; font-weight: 600; height: 2.4em; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; line-height: 1.2; }
        .add-btn { width: 100%; padding: 8px; background: #eff6ff; color: var(--primary); border: 1px solid var(--primary); border-radius: 8px; font-weight: 600; margin-top: 8px; }

        /* SHEET & GALLERY */
        .sheet-mask { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:100; display:none; backdrop-filter: blur(3px); }
        .sheet { position: fixed; bottom:-100%; left:0; width:100%; height:85vh; background:var(--white); border-radius:20px 20px 0 0; z-index:101; transition:0.4s; display:flex; flex-direction:column; }
        .sheet.open { bottom: 0; } .sheet-mask.open { display: block; }
        .sheet-body { flex: 1; overflow-y: auto; padding: 20px; }
        .gallery { display: flex; gap: 10px; overflow-x: auto; margin-bottom: 20px; scrollbar-width: none; }
        .thumb { width: 60px; height: 60px; border: 2px solid #eee; border-radius: 8px; object-fit: contain; padding: 2px; transition: 0.2s; }
        .thumb.active { border-color: var(--primary); transform: scale(1.05); }

        /* CART & ORDER */
        .cart-item, .order-card { background: var(--white); padding: 15px; border-radius: var(--radius); margin-bottom: 15px; display: flex; align-items: center; gap: 15px; box-shadow: 0 1px 5px rgba(0,0,0,0.05); }
        .order-card { display: block; }
        .qty-ctrl { display: flex; align-items: center; background: #f3f4f6; border-radius: 8px; padding: 2px; }
        .qty-ctrl span { padding: 4px 12px; font-weight: 600; }
        .status-badge { padding: 3px 8px; border-radius: 15px; font-size: 0.7rem; font-weight: bold; text-transform: uppercase; float: right; }
        .btn-cancel { background: #fee2e2; color: #dc2626; border: none; padding: 5px 12px; border-radius: 6px; font-size: 0.75rem; font-weight: 600; margin-top: 8px; display: inline-block; }
        .btn-view-det { background: transparent; color: var(--primary); border: 1px solid var(--primary); padding: 5px 12px; border-radius: 6px; font-size: 0.75rem; font-weight: 600; margin-top: 8px; display: inline-block; text-align: center; width: 100%; }

        /* CONTACT */
        .contact-card { background: white; border-radius: 15px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px; text-align: center; }
        .contact-btn { display: flex; align-items: center; justify-content: center; gap: 10px; padding: 12px; border-radius: 10px; text-decoration: none; font-weight: 600; color: white; margin-bottom: 10px; }
        .cb-call { background: #25D366; } 
        .social-row { display: flex; justify-content: center; gap: 20px; margin-top: 15px; }
        .social-btn { width: 55px; height: 55px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.8rem; color: white; text-decoration: none; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .sb-wa { background: #25D366; } .sb-fb { background: #1877F2; } .sb-ig { background: linear-gradient(45deg, #f09433, #bc1888); } .sb-yt { background: #FF0000; }

        /* UTILS */
        .full-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--white); z-index: 200; display: none; flex-direction: column; }
        .full-modal.open { display: flex; animation: fadeIn 0.3s; }
        .input-box { width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; margin-bottom: 12px; outline: none; transition: 0.3s; }
        .input-box:focus { border-color: var(--primary); }
        .btn-main { width: 100%; padding: 14px; background: var(--primary); color: white; border: none; border-radius: 10px; font-weight: 600; font-size: 1rem; }
        .badge { position: absolute; top: -5px; right: -5px; background: var(--accent); color: #000; font-size: 0.65rem; padding: 2px 5px; border-radius: 10px; font-weight: bold; display: none; }
        #toast { position: fixed; bottom: 90px; left: 50%; transform: translateX(-50%); background: #1f2937; color: white; padding: 10px 20px; border-radius: 25px; font-size: 0.85rem; display: none; z-index: 999; }
        
        /* FULL IMAGE */
        #full-image-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 300; display: none; align-items: center; justify-content: center; }
        #full-image-modal img { max-width: 95%; max-height: 80%; }
        #full-image-close { position: absolute; top: 20px; right: 20px; color: white; font-size: 2rem; cursor: pointer; }
        
        /* ORDER DETAILS VIEW */
        .od-item-view { display: flex; gap: 15px; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px dashed #eee; align-items: center; }
        .od-img-lg { width: 100px; height: 100px; border-radius: 8px; border: 1px solid #eee; object-fit: contain; background: #fff; }
        
        /* OFFLINE ALERT */
        #offline-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.98); z-index: 20000; display: none; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
        .wifi-box { width: 100px; height: 100px; background: #fee2e2; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-bottom: 20px; animation: pulse 2s infinite; }
        @keyframes pulse { 0% {box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.4);} 70% {box-shadow: 0 0 0 20px rgba(220, 38, 38, 0);} 100% {box-shadow: 0 0 0 0 rgba(220, 38, 38, 0);} }
    </style>
</head>
<body>

    <!-- Offline Alert -->
    <div id="offline-screen">
        <div class="wifi-box"><i class="fas fa-wifi" style="font-size:3rem; color:#dc2626;"></i></div>
        <h2 style="color:#1f2937; margin-bottom:10px;">No Internet</h2>
        <p style="color:#6b7280; font-size:0.9rem;">Please check your connection.</p>
        <button onclick="window.location.reload()" class="btn-main" style="width:auto; margin-top:25px; padding:10px 40px; background:#dc2626;">Retry</button>
    </div>

    <!-- Splash -->
    <div id="splash" style="position:fixed; top:0; left:0; width:100%; height:100%; background:#0f172a; z-index:9999; display:flex; flex-direction:column; align-items:center; justify-content:center;">
        <div class="logo-icon" style="width:80px; height:80px; margin-bottom:15px; border-width:4px;">
            <div class="logo-slider">
                <i class="fas fa-tv" style="width:72px; height:72px; font-size:3rem;"></i>
                <i class="fas fa-snowflake" style="width:72px; height:72px; font-size:3rem;"></i>
                <i class="fas fa-fan" style="width:72px; height:72px; font-size:3rem;"></i>
                <i class="fas fa-bolt" style="width:72px; height:72px; font-size:3rem;"></i>
            </div>
        </div>
        <div class="logo-text-group" style="align-items:center; transform:scale(1.5);">
            <span class="txt-main">ऋषिकेश</span>
            <span class="txt-sub">इलेक्ट्रॉनिक्स</span>
            <span class="txt-small">सेल्स अँड सर्व्हिसेस</span>
        </div>
    </div>

    <!-- App Shell -->
    <div class="app-shell">
        <header class="header">
            <div class="logo-wrapper">
                <div class="logo-icon">
                    <div class="logo-slider">
                        <i class="fas fa-tv"></i><i class="fas fa-snowflake"></i><i class="fas fa-fan"></i><i class="fas fa-bolt"></i>
                    </div>
                </div>
                <div class="logo-text-group"><span class="txt-main">ऋषिकेश</span><span class="txt-sub">इलेक्ट्रॉनिक्स</span><span class="txt-small">सेल्स अँड सर्व्हिसेस</span></div>
            </div>
            <div style="display:flex; gap:20px;">
                <i class="fas fa-search" onclick="nav('search')" style="font-size:1.3rem; color:white;"></i>
                <div style="position:relative;" onclick="nav('cart')">
                    <i class="fas fa-shopping-bag" style="font-size:1.3rem; color:white;"></i><span id="badge" class="badge">0</span>
                </div>
            </div>
        </header>

        <main class="content" id="main-scroll">
            
            <!-- Home -->
            <section id="home" class="page active">
                <div class="slider"><div class="track" id="slider-track"></div></div>
                <h3 style="margin-bottom:10px; font-weight:700; padding-left:5px;">Categories</h3>
                <div class="cats" id="cat-list"></div>
                <h3 style="margin-bottom:10px; font-weight:700; padding-left:5px;">Featured Products</h3>
                <div class="grid" id="prod-grid"></div>
            </section>

            <!-- Search -->
            <section id="search" class="page">
                <input type="text" class="input-box" id="s-input" placeholder="Search Product or Category..." autofocus>
                <div class="grid" id="s-results" style="margin-top:20px;"></div>
            </section>

            <!-- Cart -->
            <section id="cart" class="page">
                <h2 style="margin-bottom:15px;">My Cart</h2>
                <div id="cart-list"></div>
                <div id="cart-summary" style="display:none; background:white; padding:20px; border-radius:var(--radius); margin-top:15px; box-shadow:0 2px 10px rgba(0,0,0,0.05);">
                    <div style="display:flex; justify-content:space-between; font-weight:700; margin-bottom:15px;"><span>Total</span><span id="cart-total" style="color:var(--primary);">₹0</span></div>
                    <button class="btn-main" onclick="openCheckout()">Checkout Now</button>
                </div>
            </section>

            <!-- Contact -->
            <section id="contact" class="page">
                <div class="contact-card">
                    <div class="logo-icon" style="width:70px; height:70px; margin:0 auto 15px auto; border-width:3px;">
                        <div class="logo-slider">
                            <i class="fas fa-tv" style="width:64px; height:64px; font-size:2rem;"></i>
                            <i class="fas fa-snowflake" style="width:64px; height:64px; font-size:2rem;"></i>
                            <i class="fas fa-fan" style="width:64px; height:64px; font-size:2rem;"></i>
                            <i class="fas fa-bolt" style="width:64px; height:64px; font-size:2rem;"></i>
                        </div>
                    </div>
                    <h2 class="txt-main" style="font-size:1.5rem;">ऋषिकेश इलेक्ट्रॉनिक्स</h2>
                </div>
                <div class="contact-card"><div id="shop-details">Loading...</div><div id="contact-actions" style="margin-top:15px;"></div></div>
                <div style="text-align:center; margin-top:20px;"><h3 style="margin-bottom:15px;">Follow Us</h3><div class="social-row" id="social-links"></div></div>
                <div style="background:white; padding:20px; border-radius:12px; margin-top:25px; line-height:1.6; color:#555;" id="about-text"></div>
            </section>

            <!-- Profile -->
            <section id="profile" class="page">
                <div style="background:white; padding:25px; border-radius:var(--radius); text-align:center; margin-bottom:20px; box-shadow:0 2px 10px rgba(0,0,0,0.05);">
                    <div style="width:70px; height:70px; background:#eff6ff; border-radius:50%; margin:0 auto 10px; display:flex; align-items:center; justify-content:center; font-size:2rem; color:var(--primary);"><i class="fas fa-user-circle"></i></div>
                    <h2 id="u-name" style="margin-bottom:5px;">Guest</h2>
                    <p id="u-email" style="color:#6b7280; margin-bottom:20px;">Sign in to track orders</p>
                    <button id="btn-in" class="btn-main" onclick="openModal('auth-modal')">Login / Register</button>
                    <button id="btn-out" class="btn-main" style="background:var(--danger); display:none;" onclick="logout()">Logout</button>
                </div>
                <h3 style="margin:20px 0 15px 5px; font-weight:700;">Order History</h3>
                <div id="order-list"></div>
            </section>
        </main>

        <nav class="nav">
            <a onclick="nav('home')" class="nav-item active" id="n-home"><i class="fas fa-home"></i>Home</a>
            <a onclick="nav('search')" class="nav-item" id="n-search"><i class="fas fa-search"></i>Search</a>
            <a onclick="nav('cart')" class="nav-item" id="n-cart"><i class="fas fa-shopping-cart"></i>Cart</a>
            <a onclick="nav('contact')" class="nav-item" id="n-contact"><i class="fas fa-phone-alt"></i>Contact</a>
            <a onclick="nav('profile')" class="nav-item" id="n-profile"><i class="fas fa-user"></i>Profile</a>
        </nav>
    </div>

    <!-- SHEET & MODALS -->
    <div class="sheet-mask" onclick="closeSheet()"></div>
    <div class="sheet" id="sheet">
        <div class="sheet-body">
            <div style="text-align:right;"><i class="fas fa-times" style="font-size:1.5rem; padding:5px;" onclick="closeSheet()"></i></div>
            <img id="sh-img" src="" style="width:100%; height:220px; object-fit:contain; margin-bottom:15px; cursor:zoom-in;" onclick="viewFullImage(this.src)">
            <div class="gallery" id="sh-gallery" style="display:none;"></div>
            <h2 id="sh-name" style="line-height:1.2;"></h2>
            <div style="color:#6b7280; font-size:0.85rem; margin:5px 0 10px 0;" id="sh-cat"></div>
            <div id="sh-price-box" style="margin-bottom:15px;"></div>
            <div style="border-top:1px dashed #ddd; padding-top:15px;"><p id="sh-desc" style="color:#555; font-size:0.9rem;"></p></div>
        </div>
        <div style="padding:15px; border-top:1px solid #eee; display:flex; gap:10px;">
            <button style="border:2px solid #eee; background:white; width:50px; border-radius:10px;" id="sh-fav"><i class="far fa-heart"></i></button>
            <button class="btn-main" id="sh-add">Add to Cart</button>
        </div>
    </div>

    <!-- Full Image Modal -->
    <div id="full-image-modal">
        <span id="full-image-close" onclick="closeFullImage()">&times;</span>
        <img id="full-image-src" src="">
    </div>

    <!-- Auth Modal -->
    <div class="full-modal" id="auth-modal">
        <div style="padding:20px;"><i class="fas fa-arrow-left" style="font-size:1.5rem;" onclick="closeModal('auth-modal')"></i></div>
        <div style="padding:30px; display:flex; flex-direction:column; justify-content:center; flex:1;">
            <h2>Welcome</h2><p style="color:#666; margin-bottom:30px;">Login to continue</p>
            <form id="login-f"><input type="email" id="le" class="input-box" placeholder="Email Address"><input type="password" id="lp" class="input-box" placeholder="Password"><button class="btn-main">Secure Login</button></form>
            <p style="text-align:center; margin-top:20px;">New? <span onclick="toggleReg()" style="color:var(--primary); font-weight:600; cursor:pointer;">Create Account</span></p>
            <form id="reg-f" style="display:none;"><input type="email" id="re" class="input-box" placeholder="Email Address"><input type="password" id="rp" class="input-box" placeholder="Create Password"><button class="btn-main">Create Account</button></form>
        </div>
    </div>

    <!-- Checkout Modal -->
    <div class="full-modal" id="checkout-modal">
        <div style="padding:20px; font-weight:bold; border-bottom:1px solid #eee;"><i class="fas fa-arrow-left" onclick="closeModal('checkout-modal')"></i> Checkout</div>
        <div style="padding:25px;">
            <div style="background:#eff6ff; padding:20px; border-radius:12px; margin-bottom:25px; color:#1e40af;">Total Payable: <b id="co-total" style="font-size:1.2rem;">₹0</b></div>
            <form id="co-f">
                <input type="text" id="cn" class="input-box" placeholder="Full Name" required>
                <input type="tel" id="cp" class="input-box" placeholder="Mobile (10 digits)" required>
                <textarea id="ca" class="input-box" rows="3" placeholder="Address" required></textarea>
                <div style="margin:20px 0; padding:15px; border:1px solid #22c55e; background:#f0fdf4; border-radius:12px; display:flex; align-items:center; gap:10px;">
                    <div style="width:35px; height:35px; background:#22c55e; border-radius:50%; display:flex; align-items:center; justify-content:center; color:white;"><i class="fas fa-money-bill-wave"></i></div>
                    <span style="font-weight:600; color:#15803d; flex:1;">Cash on Delivery</span>
                    <i class="fas fa-check-circle" style="color:#22c55e; font-size:1.2rem;"></i>
                </div>
                <button class="btn-main">Place Order</button>
            </form>
        </div>
    </div>

    <!-- Cancel Modal -->
    <div class="full-modal" id="cancel-modal">
        <div style="padding:20px; font-weight:bold;"><i class="fas fa-arrow-left" onclick="closeModal('cancel-modal')"></i> Cancel Order</div>
        <div style="padding:30px; display:flex; flex-direction:column; flex:1; justify-content:center;">
            <h3>Are you sure?</h3><form id="cancel-f"><input type="hidden" id="cancel-oid"><textarea id="cancel-reason" class="input-box" rows="4" placeholder="Reason..." required></textarea><button class="btn-main" style="background:var(--danger);">Confirm</button></form>
        </div>
    </div>

    <!-- View Order Details Modal -->
    <div class="full-modal" id="view-order-modal">
        <div style="padding:20px; font-weight:bold; border-bottom:1px solid #eee;"><i class="fas fa-arrow-left" style="cursor:pointer;" onclick="closeModal('view-order-modal')"></i> Order Details</div>
        <div style="padding:20px; overflow-y:auto; flex:1;">
            <div id="vo-content"></div>
        </div>
    </div>

    <div id="toast">Message</div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
        import { getDatabase, ref, get, set, push, remove, onValue, update } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

        // FIREBASE CONFIG - REPLACE THIS
        const app=initializeApp({apiKey: "AIzaSyBMxGk7u49JcwvMh6HOIUTgMwlYjcDxwIM",authDomain: "third-technique-457315-i1.firebaseapp.com",databaseURL: "https://third-technique-457315-i1-default-rtdb.firebaseio.com",projectId: "third-technique-457315-i1",storageBucket: "third-technique-457315-i1.firebasestorage.app",messagingSenderId: "17139707144",appId: "1:17139707144:web:c8fa79d55a99ac16c150bd"});
        const auth=getAuth(app), db=getDatabase(app), conv=new showdown.Converter();
        let products=[], user=null, shopInfo={}, myOrders=[];

        window.onload=()=>{setTimeout(()=>{document.getElementById('splash').style.opacity='0'; setTimeout(()=>{document.getElementById('splash').style.display='none'},500)},2500); init();}

        // --- INTERNET CHECK ---
        const checkNet = () => {
            const offline = document.getElementById('offline-screen');
            if(!navigator.onLine) {
                if(!offline) document.body.insertAdjacentHTML('beforeend', `<div id="offline-screen" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.98); z-index:20000; display:flex; flex-direction:column; align-items:center; justify-content:center; text-align:center;"><div style="width:100px; height:100px; background:#fee2e2; border-radius:50%; display:flex; align-items:center; justify-content:center; margin-bottom:20px; animation:pulse 2s infinite;"><i class="fas fa-wifi" style="font-size:3rem; color:#dc2626;"></i></div><h2 style="color:#1f2937; margin-bottom:10px;">No Internet</h2><p style="color:#6b7280;">Please check your connection.</p><button onclick="window.location.reload()" class="btn-main" style="width:auto; margin-top:20px; padding:10px 40px; background:#dc2626;">Retry</button></div>`);
            } else {
                if(offline) offline.remove();
            }
        };
        window.addEventListener('online', checkNet);
        window.addEventListener('offline', checkNet);
        checkNet();

        const init=()=>{
            get(ref(db,'sliderImages')).then(s=>{ if(s.exists()){ const i=Object.values(s.val()); document.getElementById('slider-track').innerHTML=i.map(u=>`<img src="${u}" style="min-width:100%;height:100%;object-fit:cover;">`).join(''); let x=0; setInterval(()=>{x=(x+1)%i.length;document.getElementById('slider-track').style.transform=`translateX(-${x*100}%)`},3000); }});
            get(ref(db,'products')).then(s=>{ if(s.exists()){ products=Object.entries(s.val()).map(([k,v])=>({id:k,...v})); render(products); renderCats(); }});
            onValue(ref(db,'shopInfo'),s=>{ 
                shopInfo=s.val()||{}; 
                document.getElementById('shop-details').innerHTML = `<p style="font-weight:600; color:#333;"><i class="fas fa-map-marker-alt" style="color:var(--primary); margin-right:5px;"></i> Address</p><p style="font-size:0.9rem; color:#666; margin-bottom:10px;">${shopInfo.addr || 'Address not available'}</p>`;
                if(shopInfo.ph) document.getElementById('contact-actions').innerHTML = `<a href="tel:${shopInfo.ph}" class="contact-btn cb-call"><i class="fas fa-phone-alt"></i> Call Now</a>`;
                let lnk = '';
                if(shopInfo.ph) lnk += `<a href="https://wa.me/91${shopInfo.ph}" target="_blank" class="social-btn sb-wa"><i class="fab fa-whatsapp"></i></a>`;
                if(shopInfo.fb) lnk += `<a href="${shopInfo.fb}" target="_blank" class="social-btn sb-fb"><i class="fab fa-facebook-f"></i></a>`;
                if(shopInfo.ig) lnk += `<a href="${shopInfo.ig}" target="_blank" class="social-btn sb-ig"><i class="fab fa-instagram"></i></a>`;
                if(shopInfo.yt) lnk += `<a href="${shopInfo.yt}" target="_blank" class="social-btn sb-yt"><i class="fab fa-youtube"></i></a>`;
                document.getElementById('social-links').innerHTML = lnk;
                document.getElementById('about-text').innerHTML = shopInfo.aboutText ? conv.makeHtml(shopInfo.aboutText) : "Welcome to Rushikesh Electronics.";
            });
        };

        const render=(list)=>{
            document.getElementById('prod-grid').innerHTML=list.map(p=>{
                const price=parseFloat(p.price)||0, off=parseFloat(p.offerPercent)||0, final=Math.round(price*(1-off/100));
                return `<div class="card" onclick="openSheet('${p.id}')">${off>0?`<span class="off-badge">${off}% OFF</span>`:''}<div class="card-img"><img src="${p.imageUrl}" onerror="this.src='https://placehold.co/150'"></div><div class="card-info"><div class="card-title">${p.name}</div><div style="font-weight:700; color:var(--primary); font-size:1.1rem;">₹${final} ${off>0?`<small style="color:#9ca3af; text-decoration:line-through; font-size:0.7rem;">₹${price}</small>`:''}</div><button class="add-btn" onclick="event.stopPropagation();addCart('${p.id}')">Add</button></div></div>`;
            }).join('');
        };

        const renderCats=()=>{ const c=['All',...new Set(products.map(p=>p.category))]; document.getElementById('cat-list').innerHTML=c.map(x=>`<div class="cat-item" onclick="filter('${x}')"><div class="cat-icon"><i class="fas fa-bolt"></i></div><span style="font-size:0.8rem; font-weight:500;">${x}</span></div>`).join(''); };
        window.filter=(c)=>{ render(c==='All'?products:products.filter(p=>p.category===c)); };
        
        // FIXED SEARCH LOGIC
        document.getElementById('s-input').addEventListener('input', (e)=>{
            const t=e.target.value.toLowerCase().trim();
            if(!t) { document.getElementById('s-results').innerHTML='<div style="grid-column:1/-1;text-align:center;margin-top:50px;color:#999;">Type to search...</div>'; return; }
            const res=products.filter(p=>p.name.toLowerCase().includes(t)||p.category.toLowerCase().includes(t));
            document.getElementById('s-results').innerHTML = res.length ? res.map(p=>{
                const price=parseFloat(p.price)||0, off=parseFloat(p.offerPercent)||0, final=Math.round(price*(1-off/100));
                return `<div class="card" onclick="openSheet('${p.id}')">${off>0?`<span class="off-badge">${off}% OFF</span>`:''}<div class="card-img"><img src="${p.imageUrl}"></div><div class="card-info"><div class="card-title">${p.name}</div><div style="font-weight:700;color:var(--primary);">₹${final}</div></div></div>`;
            }).join('') : '<div style="grid-column:1/-1;text-align:center;margin-top:50px;color:#999;">No products found</div>';
        });

        // Full Screen Image
        window.viewFullImage = (src) => { document.getElementById('full-image-src').src = src; document.getElementById('full-image-modal').style.display = 'flex'; };
        window.closeFullImage = () => { document.getElementById('full-image-modal').style.display = 'none'; };

        window.openSheet=(id)=>{
            const p=products.find(x=>x.id===id);
            const price=parseFloat(p.price)||0, off=parseFloat(p.offerPercent)||0, final=Math.round(price*(1-off/100));
            document.getElementById('sh-img').src=p.imageUrl; document.getElementById('sh-name').innerText=p.name; document.getElementById('sh-cat').innerText=p.category;
            document.getElementById('sh-price-box').innerHTML = `<span style="font-size:1.8rem; font-weight:700; color:var(--primary);">₹${final}</span>${off>0?`<span style="text-decoration:line-through; color:#9ca3af; font-size:1.2rem; margin-left:10px;">₹${price}</span>`:''}`;
            document.getElementById('sh-desc').innerHTML=conv.makeHtml(p.description||'');
            const gal=document.getElementById('sh-gallery');
            if(p.images&&p.images.length>1){ gal.style.display='flex'; gal.innerHTML=p.images.map(src=>`<img src="${src}" class="thumb" onclick="swapImg('${src}', this)">`).join(''); } else gal.style.display='none';
            const list=JSON.parse(localStorage.getItem('wishlist')||'{}');
            document.getElementById('sh-fav').innerHTML=list[id]?`<i class="fas fa-heart" style="color:var(--danger)"></i>`:`<i class="far fa-heart"></i>`;
            document.getElementById('sh-fav').onclick=()=>togWish(id);
            document.getElementById('sh-add').onclick=()=>{addCart(id);closeSheet();};
            document.getElementById('sheet').classList.add('open'); document.querySelector('.sheet-mask').classList.add('open');
        };
        window.swapImg=(s,el)=>{document.getElementById('sh-img').src=s; document.querySelectorAll('.thumb').forEach(t=>t.classList.remove('active')); el.classList.add('active');};
        window.closeSheet=()=>{document.getElementById('sheet').classList.remove('open');document.querySelector('.sheet-mask').classList.remove('open');};

        window.addCart=async(id)=>{
            const p=products.find(x=>x.id===id);
            let c=user?(await get(ref(db,`users/${user.uid}/cart`))).val()||{}:JSON.parse(localStorage.getItem('cart')||'{}');
            if(c[id])c[id].quantity++; else c[id]={name:p.name,imageUrl:p.imageUrl,price:parseFloat(p.price),offerPercent:parseFloat(p.offerPercent)||0,gstRate:parseFloat(p.gstRate)||18,quantity:1};
            saveCart(c); showToast("Added to Cart");
        };
        const saveCart=async(c)=>{if(user)await set(ref(db,`users/${user.uid}/cart`),c); else localStorage.setItem('cart',JSON.stringify(c)); updateBadge(c);};
        const updateBadge=(c)=>{const n=Object.values(c).reduce((a,b)=>a+(b.quantity||0),0); document.getElementById('badge').innerText=n; document.getElementById('badge').style.display=n>0?'block':'none';};

        window.renderCart=async()=>{
            const c=user?(await get(ref(db,`users/${user.uid}/cart`))).val()||{}:JSON.parse(localStorage.getItem('cart')||'{}');
            const items=Object.entries(c).filter(([k,v])=>v&&v.quantity>0&&!isNaN(v.price));
            if(!items.length){document.getElementById('cart-list').innerHTML='<div style="text-align:center; margin-top:50px; color:#9ca3b8;"><i class="fas fa-shopping-cart" style="font-size:3rem; opacity:0.5;"></i><p>Cart is Empty</p></div>'; document.getElementById('cart-summary').style.display='none'; return;}
            let tot=0;
            document.getElementById('cart-list').innerHTML=items.map(([id,i])=>{
                const p=Math.round(i.price*(1-i.offerPercent/100)), sub=p*i.quantity; tot+=sub;
                return `<div class="cart-item"><img src="${i.imageUrl}" width="60" height="60" style="object-fit:contain; border-radius:8px;"><div style="flex:1;"><b>${i.name}</b><br><span style="color:var(--primary); font-weight:700;">₹${p}</span></div><div class="qty-ctrl"><span onclick="modQty('${id}',-1)">-</span><span style="cursor:default;">${i.quantity}</span><span onclick="modQty('${id}',1)">+</span></div></div>`;
            }).join('');
            document.getElementById('cart-total').innerText=`₹${Math.round(tot*1.18)}`;
            document.getElementById('cart-summary').style.display='block';
        };
        window.modQty=async(id,n)=>{ let c=user?(await get(ref(db,`users/${user.uid}/cart`))).val():JSON.parse(localStorage.getItem('cart')); if(c[id]){c[id].quantity+=n;if(c[id].quantity<=0)delete c[id];saveCart(c);renderCart();} };

        window.openCheckout=()=>{if(!user)openModal('auth-modal'); else{document.getElementById('co-total').innerText=document.getElementById('cart-total').innerText;openModal('checkout-modal');}};
        document.getElementById('co-f').onsubmit=async(e)=>{
            e.preventDefault(); const ph=document.getElementById('cp').value; if(ph.length!==10){showToast("Invalid Phone");return;}
            const c=(await get(ref(db,`users/${user.uid}/cart`))).val();
            
            let finalTotal = 0;
            const items=Object.entries(c).map(([k,v])=>{
                const base = v.price * (1 - (v.offerPercent||0)/100);
                const gst = base * ((v.gstRate||18)/100);
                const final = base + gst;
                finalTotal += final * v.quantity;
                return {...v, productId:k, priceWithGST:final};
            });
            
            const ord={orderId:Date.now().toString(),date:Date.now(),shipping:{name:document.getElementById('cn').value,phone:ph,address:document.getElementById('ca').value},items,totalAmount:finalTotal,status:'Pending'};
            await push(ref(db,`orders/${user.uid}`),ord); await set(ref(db,`users/${user.uid}/cart`),{});
            closeModal('checkout-modal'); showToast("Order Placed!"); nav('profile');
        };

        onAuthStateChanged(auth,u=>{
            user=u;
            if(user){
                document.getElementById('u-name').innerText=user.email.split('@')[0]; document.getElementById('u-email').innerText=user.email;
                document.getElementById('btn-in').style.display='none'; document.getElementById('btn-out').style.display='inline-block';
                closeModal('auth-modal');
                get(ref(db,`users/${user.uid}/cart`)).then(s=>updateBadge(s.val()||{}));
                onValue(ref(db,`orders/${user.uid}`),s=>{
                    if(s.exists()) {
                        myOrders = Object.entries(s.val()).reverse(); 
                        document.getElementById('order-list').innerHTML=myOrders.map(([k,o])=>{
                            const stColor = o.status==='Pending'?'orange':o.status==='Delivered'?'#10b981':o.status==='Cancelled'?'#ef4444':'#2563eb';
                            return `<div class="order-card">
                                <div style="display:flex; justify-content:space-between; margin-bottom:5px;"><b>#${o.orderId.slice(-6)}</b> <span class="status-badge" style="background:${stColor}20; color:${stColor};">${o.status}</span></div>
                                <div style="font-size:0.8rem; color:#6b7280;">${new Date(o.date).toLocaleDateString()} • <b>₹${Math.round(o.totalAmount)}</b></div>
                                <div style="margin-top:10px; border-top:1px dashed #eee; padding-top:10px; display:flex; justify-content:space-between; align-items:center;">
                                    <button class="btn-view-det" onclick="openUserOrder('${k}')">View Details</button>
                                    ${o.status==='Pending'?`<button class="btn-cancel" onclick="openCancel('${k}')" style="margin:0; padding:5px 10px;">Cancel</button>`:''}
                                </div>
                            </div>`;
                        }).join('');
                    }
                });
            } else { updateBadge(JSON.parse(localStorage.getItem('cart')||'{}')); }
        });

        // VIEW ORDER DETAILS FUNCTION
        window.openUserOrder = (key) => {
            const orderPair = myOrders.find(pair => pair[0] === key);
            if(!orderPair) return;
            const o = orderPair[1];
            let items = o.items; if(!Array.isArray(items)) items = Object.values(items);
            
            const html = items.map(i => `
                <div class="od-item-view">
                    <img src="${i.imageUrl}" class="od-img-lg">
                    <div>
                        <div style="font-weight:600;">${i.name}</div>
                        <div style="font-size:0.85rem; color:#64748b;">
                            Qty: ${i.quantity}<br>
                            Price: ₹${Math.round(i.priceWithGST||i.price)}
                            ${i.gstRate ? `<span style="font-size:0.7rem; background:#e0e7ff; color:var(--primary); padding:2px 5px; border-radius:4px; margin-left:5px;">${i.gstRate}% GST</span>` : ''}
                        </div>
                    </div>
                </div>`).join('');
                
            document.getElementById('vo-content').innerHTML = `
                <div style="margin-bottom:15px;">
                    <p style="font-weight:bold; font-size:1.2rem;">Order #${o.orderId.slice(-6)}</p>
                    <p style="font-size:0.8rem; color:#666;">Date: ${new Date(o.date).toLocaleString()}</p>
                    <p style="font-size:0.8rem; color:#666;">Status: <span style="font-weight:bold;">${o.status}</span></p>
                </div>
                <div style="background:#f8fafc; padding:10px; border-radius:8px; margin-bottom:15px; font-size:0.9rem;">
                    <b>Shipping To:</b><br>${o.shipping.name}<br>${o.shipping.phone}<br>${o.shipping.address}
                </div>
                <h4 style="margin-bottom:10px;">Items</h4>
                ${html}
                <div style="display:flex; justify-content:space-between; margin-top:20px; border-top:2px solid #eee; padding-top:15px; font-weight:700; font-size:1.3rem;">
                    <span>Grand Total</span><span>₹${Math.round(o.totalAmount)}</span>
                </div>
            `;
            document.getElementById('view-order-modal').classList.add('open');
        };

        window.openCancel=(k)=>{ document.getElementById('cancel-oid').value=k; document.getElementById('cancel-reason').value=''; openModal('cancel-modal'); };
        document.getElementById('cancel-f').onsubmit=async(e)=>{ e.preventDefault(); await update(ref(db,`orders/${user.uid}/${document.getElementById('cancel-oid').value}`),{status:'Cancelled',cancelReason:document.getElementById('cancel-reason').value}); closeModal('cancel-modal'); showToast("Order Cancelled"); };

        window.nav=(id)=>{document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));document.getElementById(id).classList.add('active');document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));document.getElementById('n-'+id).classList.add('active');if(id==='cart')renderCart();};
        window.openModal=(id)=>document.getElementById(id).classList.add('open');
        window.closeModal=(id)=>document.getElementById(id).classList.remove('open');
        window.toggleReg=()=>{document.getElementById('login-f').style.display='none';document.getElementById('reg-f').style.display='block';};
        window.showToast=(m)=>{const t=document.getElementById('toast');t.innerText=m;t.style.display='block';setTimeout(()=>t.style.display='none',2000);};
        window.logout=()=>signOut(auth);
        window.togWish=(id)=>{let l=JSON.parse(localStorage.getItem('wishlist')||'{}'); if(l[id])delete l[id];else l[id]=1; localStorage.setItem('wishlist',JSON.stringify(l)); document.getElementById('sh-fav').innerHTML=l[id]?`<i class="fas fa-heart" style="color:var(--danger)"></i>`:`<i class="far fa-heart"></i>`;};

        document.getElementById('login-f').onsubmit=(e)=>{e.preventDefault();signInWithEmailAndPassword(auth,document.getElementById('le').value,document.getElementById('lp').value);};
        document.getElementById('reg-f').onsubmit=(e)=>{e.preventDefault();createUserWithEmailAndPassword(auth,document.getElementById('re').value,document.getElementById('rp').value);};
    </script>
</body>
</html>
